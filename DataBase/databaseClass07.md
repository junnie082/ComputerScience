# Database Class 07

## 데이터베이스 설계

#### 2023.12.06.(수)

### 1. 데이터베이스 설계

- 데이터베이스의 역할

![database23](/assets/images/2023-12-06/database23.jpeg)

- 데이터 모델링(data modeling)
  - 데이터베이스 구조를 생성하는 절차적 과정
  - 실세계를 개념화하고 논리적 구조로 추상화한 다음 물리적 테이블 구조를 컴퓨터 안에 생성하는 일련의 단계를 거쳐 데이터베이스 구조를 완성

### 데이터베이스 모델링

- 데이터 모델링 과정

![database24](/assets/images/2023-12-06/database24.jpeg)

### 1.2 데이터베이스의 설계 과정

- 반복적인 설계 과정을 통해 정제된 최종 설계 결과가 생성

![database25](/assets/images/2023-12-06/database25.jpeg)

### 2. 요구사항 분석

요구사항 명세

- 데이터베이스 설계 과정의 첫 번째 단계

  - 구축하고자 하는 데이터베이스의 구현 범위와 사용자의 범주를 결정
  - 예비 사용자들로부터 요구 사항을 수집하고 업무 처리를 위해 필요한 데이터를 분석
  - 사용자와의 인터뷰, 설문지 조사, 업무 관련 문서의 검토와 기존 시스템 또는 유사 시스템에 대한 분석 등을 포함

- 분석 결과는 요구사항 명세서로 문서화
  - 분석가는 담당자의 요구를 정확하게 파악하도록 노력하고 용어 등이 모호성이 없도록 최대한 명확하게 명세서를 정리
  - 명세서는 분석가의 자의적 해석이나 짐작이 아닌 사용자의 요구 사항만을 충실히 반영하여 구체적 문장 형태로 서술
  - 최종적인 요구사항 명세서는 사용자에게 최종 확인을 받는 과정이 필요

### 2.2 병원 DB 요구사항 명세서

- 요구사항 분석 적용 예(병원 DB)

![database26](/assets/images/2023-12-06/database26.jpeg)

### 3. 개념적 설계

- 개념적 설계(E-R 다이아그램 작성) 과정
  - 데이터베이스 설계의 전체 골격을 결정하는 과정
  - 요구사항 명세서의 내용을 기반으로 핵심적인 데이터 요소들을 추출하여 E-R 다이아그램을 작성

![database27](/assets/images/2023-12-06/database27.jpeg)

### 3.1 개체 정의

- 개체 도출

```
[개체 식별 방법]
* 개체는 저장할 가치가 있는 핵심 데이터를 가진 사람이나 사물, 장소 또는 무형적 개념을 의미한다. 보통 요구 사항 명세서 문장 중에서 주어나 목적으로 표현되는 명사들을 찾는다.
* 명사들은 서로 의미를 명확히 표현하거나 꾸며주는 연관성을 가지고 있다. 속성에 해당하는 하위 개념의 명사들로부터 꾸밈을 받는 상위 개념의 명사가 주로 개체가 된다.
* 개체는 실세계에서 독립적인 존재이므로 꾸밈을 받는 하위 개념 명사 중에 고유한 명칭(번호나 코드, 이름 등)을 가진다.
* 개체는 관계와 비교하면 상대적으로 오랜 시간 지속되는 특성이 있다.
* 개체는 보통 또 다른 여러 개체들이 공유하는 대상이다.
```

![database28](/assets/images/2023-12-06/database28.jpeg)

### 3.2 관계 정의

- 관계 도출

```
[관계 식별 방법]
* 관계는 저장 가치가 있는 데이터를 발생시키는 사건이나 행위와 같은 개체간의 연관성을 의미한다. 요구사항 명세서 문장 중에서 서술어로 표현되는 동사들을 찾는다.
* 관계는 반드시 연관성을 갖는 둘 이상의 개체가 필요하다.
* 대부분의 관계는 의미를 명확히 표현하거나 꾸며주는 하위 개념의 속성을 갖는다.
* 관계는 실세계에서 종속적 존재이므로 보통 하위 개념인 관계 속성 중에 고유한 명칭(번호, 코드, 이름 등)을 갖지 않는다.
* 관계는 개체와 비교하면 일시적이며 상대적으로 짧은 시간만 지속되는 특성이 있다.
```

- 관계 정의 예

![database29](/assets/images/2023-12-06/database29.jpeg)

### 3.3 속성 정의

- 속성 도출

```
[속성 식별 방법]
* 속성은 도출된 개체나 관계의 존재 혹은 상태를 나타내는 특성을 의미한다. 요구사항 명세서 문장 중에서 주어나 목적어, 서술어를 수식하거나 꾸며주는 하위 명사들을 찾는다.
* 속성을 보통 또 다른 속성들과 함께 공통의 특정 대상을 명확히 표현하기 위해 연관성을 가진다. 개체에 해당하는 상위 개념의 명사나 관계에 해당하는 상위 개념의 동사를 꾸며주는 하위 개념의 명사가 주로 속성이 된다. 속성은 실제 값을 저장한다.
* 속성은 실세계에서 종속적 존재이므로 상위 개념이 반드시 필요하다.
```

- 속성 정의 예

![database30](/assets/images/2023-12-06/database30.jpeg)

### 요구사항 명세서의 E-R 다이아그램 변환 규칙

- 개체, 관계, 속성 구별 방법

|             개체             |             관계             |        속성         |
| :--------------------------: | :--------------------------: | :-----------------: |
|         독립적 존재          |         종속적 존재          |     종속적 존재     |
|  명사(주어, 목적어)로 표현   |     동사(서술어)로 표현      | 명사(수식어)로 표현 |
|          상위 개념           |          상위 개념           |      하위 개념      |
| 고유한 명칭(이름, 번호) 보유 | 인위적 명칭(이름, 번호) 부여 |    해당사항 없음    |
|            지속적            |            일시적            |    지속적/일시적    |

### 요구사항 명세서 유의사항

- 유의 사항

  - 명세서 문장 안에서 개체를 찾아 사각형, 관계는 마름모, 속성은 타원형으로 표시
  - 의미가 중복되거나 반복되는 대상은 하나의 표준 용어로 통일하여 표시
  - 데이터와 직접적인 연관성이 낮거나 혹은 너무 일반적인 표현은 삭제(가운데줄) 표시
    - 특히, 데이터 관점에서 불필요하거나 기능 관련 표현들은 무시

- E-R 다이아그램 작성 시 유의 사항

|        불필요한 표현         |                      무시해도 좋은 이유                      |
| :--------------------------: | :----------------------------------------------------------: |
|         정보, 데이터         | 모든 특성에 관련되는 공통 표현에 해당되어 속성으로 부적절함  |
| 유지, 저장, 관리, 기록, 보관 |     데이터베이스의 일반 기능에 해당되어 관계로 부적절함      |
|    입력, 수정, 삭제, 검색    | 데이터베이스 시스템의 일반 기능으로 해당되어 관계로 부적절함 |
| 발급, 부여, 선택, 확인, 취소 | 관리자나 사용자의 소프트웨어 기능에 해당되어 관계로 부적절함 |

### 병원 DB E-R 다이아그램

![database31](/assets/images/2023-12-06/database31.jpeg)

### 4. 논리적 설계

- 개체 변환
  - 개체는 기본적으로 하나의 릴레이션으로 변환
    - 새로 생성된 릴레이션을 E-R 다이으갦의 개체를 표현한다고 해서 개체 릴레이션 (entity relation) 이라고 함.
    - 생성된 개체 릴레이션은 개체 이름이 릴레이션의 이름이 됨
  - 개체의 키 속성은 릴레이션의 기본키 속성으로, 일반 속성은 릴레이션의 속성으로 변환
    - 개체의 속성 이름이 릴레이션의 속성 이름이 됨

![database32](/assets/images/2023-12-06/database32.jpeg)

### 4.2 관계 변환

- 일대다(1:n) 관계 변환

  - 일대다 관계 자체는 하나의 외래키 속성으로 변환한다.
  - 일대다 관계를 갖는 두 릴레이션(개체에서 변환됨)에서 '일'(1) 측 개체 릴레이션의 기본키 속성을 가져와 '다'(n)측 개체 릴레이션에 `외래키 속성`으로 추가하여 포함시킨다. 추가하는 외래키 속성의 이름에 관계 이름을 포함하도록 변경(예를 들면 '과번호'를 '소속진료과번호'처럼 변경)하면 그 의미를 명확히 할 수 있다.
  - 일대다 관계가 가지고 있던 모든 하위 속성들도 외래기클ㄹ 추가한 '다'(n)측 개체 릴레이션의 속성으로 함께 변환한다.

- 일대일(1:1) 관계 변환
  - 일대일 관계 자체도 일대다 관계의 경우처럼 하나의 외래키 속성으로 변환한다.
  - 한쪽 개체 릴레이션의 기본키 속성을 가져와 다른 쪽 개체 릴레이션에 외래키 속성으로 포함시킨다. 어느 쪽 릴레이션에 `외래키`를 추가하더라도 상관없다.
  - 일대일 관계가 갖고 있던 모든 속성들도 외래키를 추가한 릴레이션의 속성으로 함께 변환한다.

![database33](/assets/images/2023-12-06/database33.jpeg)

```
<방법1>
환자(주민등록번호, 전화번호, 이름, 나이, 간병인전화번호, 간병일수)
간병인(전화번호, 이름, 경력연수, 간병환자주민등록번호)

<방법2>
환자(주민등록번호, 전화번호, 이름, 나이, 간병인전화번호, 간병일수)
간병인(전화번호, 이름, 경력연수)

<방법3>
환자(주민등록번호, 전화번호, 이름, 나이)
간병인(전화번호, 이름, 경력연수, 간병환자주민등록번호, 간병일수)
```

- 다대다(m:n) 관계 변환
  - 다대다 관계는 하나의 `독립된 릴레이션`으로 변환된다. 관계 이름이 새로운 릴레이션의 이름이 된다.
  - 관계의 속성은 릴레이션의 속성으로 변환된다. 관계 속성 이름이 새로운 릴레이션의 속성 이름이 된다.
  - 새로 생성된 릴레이션을 E-R 다이어그램의 관계를 표현한다는 의미에서 `관계 릴레이션(relationship relation`이라고 한다. 관계 릴레이션은 보통 키 속성이 없으므로 관계를 맺고 있던 양쪽 개체 릴레이션의 기본키 속성을 외래키 속성으로 포함시키고 양쪽 기본키의 조합을 새로운 기본키로 지정한다. 양쪽 기본키 속성의 이름이 같을 경우, 이름을 다르게 변경한다.

```
의사(의사번호, 이름, 진료과목)
진료(의사번호, 환자주민등록번호, 진료날짜, 진료내용)
환자(주민등록번호, 전화번호, 이름, 나이)
```

### 4.3 병원 DB 논리적 스키마 작성

- 병원 DB의 논리적 데이터베이스 스키마

![database35](/assets/images/2023-12-06/database35.jpeg)
