# Final

#### 2023.12.06.(수)

## 정규화

### 논리적 데이터베이스 설계

- ER 스키마 -> 관계 스키마로 사상

- 효율적인 데이터베이스 스키마 구축
  - 키, 무결성
  - 이상 현상
  - 함수적 종속성
  - 정규화 (테이블을 분해하는 과정)

### 1. 정규화와 이상 현상

- 데이터베이스 설계(database design)

  - 대량의 데이터를 데이터베이스 안에 어떻게 조직하여 구성하느냐는 중요한 문제
  - 현실 세계를 정확하고 자연스럽게 반영할 수 있도록 데이터베이스의 논리적 구조를 결정
  - 전체 데이터베이스에 대한 통합된 하나의 스키마(schema)를 정의

- 이상 현상

  - 잘못된 스키마 정의는 원하지 않는 여러 이상 현상을 발생시킴
    - SELECT 문으로 검색할 경우는 아무런 이상 현상이 발생하지 않음
    - INSERT, UPDATE, DELETE 문으로 데이터를 변경할 때는 3가지 이상 현상이 발생

- 정규화
  - 잘못된 스키마 정의를 바로 잡는 데이터베이스 설계 방법

### 1.2 이상(anomaly) 현상

1. 필요한 속성 값을 추가하다 보면 중복이 발생: 설계 오류
2. 데이터 중복으로 인해 릴레이션 조작 시 예상하지 못한 곤란한 현상이 발생
3. 이상 현상은 속성들 간에 존재하는 여러 종류의 종속 관계를 하나의 릴레이션으로 표현할 때 발생

### 1.2 이상 현상

1. 삽입 이상(insertion anomaly)

- 데이터를 삽입할 때 입력할 수 없는 상황이 발생
- 복합키인 경우, null 값이 발생하는 상황이 발생(개체 무결성 위배)

2. 갱신 이상(update anomaly)

- 002 학생이 기계과를 건축과로 수정할 때를 가정, 건축과와 기계과라는 데이터 불일치 발생
- 중복된 속성 값 중 일부가 수정되지 않을 경우 데이터 불일치가 발생할 수 있는 상황

3. 삭제 이상(deletion anomaly)

- 001 학번 학생이 C001을 수강 취소할 때 C001을 삭제하기 위해 학번, 학과 정보가 발생
- 삭제할 때 원하지 않는 유용한 데이터까지 함께 삭제되어 데이터 손실이 발생할 수 있는 상황

### 1.3 정규화의 개념

- 이상현상 발생 원인

  - 속성 사이의 많은 연관 관계를 무리하게 하나의 릴레이션으로 표현할 때 발생
    - 이를 방지하려면 속성 사이의 연관 관계 즉, 종속성(dependency)을 분석하여 하나의 릴레이션에는 하나의 종속성만 표현되도록 릴레이션을 분해하면 됨
  - 기본적으로 연관성이 높은 속성들을 하나의 릴레이션으로 구성하는 것이 바람직

- 정규화(normalization)
  - 데이터 이상 방지를 위해 중복을 감소시키는 구조로 단계적 규칙에 따라 릴레이션을 분해하는 과정
  - 잘못된 설계를 바로 잡는 과정

### 2. 함수 종속성

2.1 함수 종속성 정의

- 함수 종속성(FD: Functional Dependency)
  - 같은 릴레이션 안의 속성 간에 특정 속성 값이 함수적으로 다른 속성 값을 결정하는 종속 관계
  - X -> Y 로 표현(X이면 Y이다.)
  - X는 결정자(Determinant), Y는 종속자(Dependent)
  - 학번 -> 김연아는 함수 종속, but 김연아 -> 학번은 함수 종속이 아님

![database01](/assets/images/2023-12-07/database01.jpeg)

-같은 릴레이션 안에 포함된 속성 사이의 연관성을 분석할 수 있는 척도

- '속성1 -> 속성2'로 표기
  - 어떤 속성2의 값이 다른 속성1의 값에 의해 결정되는 함수 종속 관계
  - 속성1은 속성2를 결정하는 결정자(determinant), 속성2는 속성1에 종속된 종속자(dependent)

![database02](/assets/images/2023-12-07/database02.jpeg)

```
학번 -> 이름
학번 -> 주소
학번 -> 학년
학번 -> 성별

학번 -> (이름, 주소, 학년, 성별)
```

### 2.2 함수 종속 다이아그램

- 함수 종속 다이아그램(FD diagram)

  - 하나의 릴레이션을 구성하는 속성들 간의 복잡한 함수 종속 관계를 이해하기 쉽도록 표현한 그림
  - 릴레이션 속성은 사각형으로, 속성 간의 함수 종속성은 화살표로 표기

- '학생\_1' 릴레이션의 모든 함수 종속성을 함수 종속 다이아그램으로 표현

![database03](/assets/images/2023-12-07/database03.jpeg)

### 완전 함수 종속과 부분 함수 종속성

- 기본키가 복합키로 구성되어 있을 때, A(a,b,c,d,e,f)
  - 단일 속성 값으로 기본키로 구성되어 있을 때는 부분 함수 종속을 따질 필요가 없음
  - 학번이 과목코드를 결정? 학번이 성적을 결정? 학번이 학과를 결정?
  - (학번, 과목코드) 성적을 결정?

![database04](/assets/images/2023-12-07/database04.jpeg)

### 완전 함수 종속과 부분 함수 종속성

- 완전 함수 종속(full functional dependency)

- 부분 함수 종속(partial functional dependency)
  - 부분 함수 종속을 제거

![database05](/assets/images/2023-12-07/database05.jpeg)

- 이행적 함수 종속 (3정규형 만족을 못함)

  - A -> B -> C
  - 결국, A -> C 인 경우, 이행적 함수 종속
  - 학생이란 릴레이션의 구성 (학번, 이름, 주민등록번호)
    - 학번 -> 주민등록번호 -> 이름
    - 이행적 함수 종속 성립
    - 학번, 주민등록번호로 구성, 주민등록번호, 이름으로 구성된 테이블로 분리

- 다치종속 (MVD, Multi Value Dependent)

  - 다치 종속은 A ->-> B, A에 해당하는 B 값이 여러 개(집합으로 나올 때)일 때

- 조인종속

### 다치 종속

![database06](/assets/images/2023-12-07/database06.jpeg)

### 조인 종속

![database07](/assets/images/2023-12-07/database07.jpeg)

![database08](/assets/images/2023-12-07/database08.jpeg)

### 함수 종속 다이아그램의 예

- 함수 종속 다이아그램의 예(수강\_1)

![database09](/assets/images/2023-12-07/database09.jpeg)

### 정규화의 개념

- 정규화 과정에서 이상 문제를 해결하려면 연관성이 높은 속성들로만 릴레이션을 구성해야 함
  - 릴레이션 속성 사이의 연관성을 평가하기 위한 척도가 필요 -> 함수 종속성

![database10](/assets/images/2023-12-07/database10.jpeg)

### 3. 기본 정규형

3.1 정규형의 종류

![database11](/assets/images/2023-12-07/database11.jpeg)

- 정규형(NF: Normal Form)

  - 정규화 과정에서 릴레이션이 만족해야 하는 특정한 함수 종속성의 충족 조건
    - 특정 정규형이 요구하는 충족 조건을 릴레이션이 만족하면 해당 수준의 정규형을 충족함을 의미함
  - 제3정규형 이상의 정규형을 충족하면 충분한 정규화가 이루어졌다고 봄
    - 보통 제3정규형 또는 보이스코드 정규형까지만 정규화를 진행

- ER 스키마 -> 관계형 스키마로 매핑

- 비정규 릴레이션 -> 정규화된 릴레이션

  - 삽입, 식제, 갱신 이상을 최소화

- 정규화의 목적

  - 데이터 구조의 안정성을 최대화
  - 중복을 배제하여 삽입, 삭제, 갱신 이상 발생을 방지
  - 데이터 삽입 시 릴레이션을 재구성할 필요성을 줄임
  - 효과적인 검색 알고리즘을 생성

- 효율적인 데이터베이스 구축을 위해...

- Every entity in your database needs to have a single theme. (Edgar Codd)

- ERD
  - 필요한 속성들을 모두 포함
  - 필요없는 속성도 포함될 가능성 존재
  - 하나의 주제에 관계있는 속성들로 구성

![database12](/assets/images/2023-12-07/database12.jpeg)

### 3.2 제1정규형

- 제1정규형 정의

```
제1정규형(1NF): 어떤 릴레이션 R에 속한 모든 속성의 도메인이 원자 값(atomic value)만을 갖는다면 제1정규형(First Normal Form)에 속한다.
```

- 열에는 순서가 없다, 행에는 순서가 없다. 중복되는 열이 없다. 모든 행은 규칙적이다. 모든 열과 행의 중복지점에는 (열과 행의) 해당되는 분야에서 한 개의 값(single value)을 갖는다.

- 정규화 대상인 릴레이션이 관계형 데이터 모델의 가본 원칙을 따르기만 한다면 당연히 제1정규형에 속함

```
학생_2(학번, 학생이름, 주소, {전화번호}, 성별)   제1정규형(x)
학생_3(학번, 학생이름, 주소, 집전화번호, 휴대폰번호, 성별)  제1정규형(o)
```

### 제1정규형의 문제점

![database13](/assets/images/2023-12-07/database13.jpeg)

- (1-1) 삽입 이상

  - 과목번호 'C006'인 과목의 개설학과가 '통계'학과라는 사실만 따로 삽입할 수가 없음

- (1-2) 수정 이상

  - 컴퓨터학과의 학과장이 '박유찬'에서 '홍길동'으로 변경될 경우, 과목개설학과 '컴퓨터'인 모든 튜플을 찾아 '학과장' 속성 값을 한꺼번에 '홍길동'으로 변경해야 함

- (1-3) 삭제 이상
  - 만약, 학번 's002' 학생이 과목번호 'c002' 과목 수강을 취소하여 이 튜플을 삭제하면 'c002' 과목의 개설학과가 '경영'학과이고 학과장이 '김철수'라는 원하지 않은 정보까지 데이터베이스에서 함께 삭제됨

### 제1정규형의 문제점 해결

![database14](/assets/images/2023-12-07/database14.jpeg)

### 무손실 분해

- 무손실 분해(nonloss decomposition)

  - 정규화 과정에서 릴레이션 분해는 어떤 정보도 손실되지 않게 동등한 릴레이션들로 분해해야 함
  - 정보 손실 없이 프로젝트(project) 연산으로 무손실 분해된 릴레이션은 자연 조인 (natural join) 연산에 의해 다시 분해 이전의 릴레이션으로 복원이 가능
  - 복원이 불가능하면 잘못된 분해이며 이는 올바른 정규화가 아님

- 결정자와 결정자에 종속되는 속성들을 함께 뗴어내어 새로운 릴레이션을 생성할 때 결정자를 분할 전의 릴레이션에도 공통 속성으로 남겨두어야 함
  - 결정자가 이후 외래키로써 분해된 릴레이션 사이의 연관성을 유지할 수 있음

### 3.3 제2정규형

- 제2정규형 정의

```
제2정규형(2NF): 어떤 릴레이션 R이 제1정규형이고 기본키에 속하지 않는 모든 속성이 기본키에 완전 함수 종속이면 제2정규형(Second Normal Form)에 속한다.
```

- 제2정규형은 제1정규형을 충족하는 릴레이션의 기본키가 복합 속성일 때, 기본키의 일부 속성이 결정자인지를 검사함
- 만약 기본키가 단일 속성이면, 모든 속성이 완전 함수 종속이므로 검사할 필요가 없이 제2정규형에 속함

```
학생_3(학번, 학생이름, 주소, 집전화번호, 휴대폰번호, 성별)  제2정규형(o)
수강_2(학번, 과목번호, 학점, 학년, 과목개설학과, 학과장)  제2정규형(x)
수강_3(학번, 과목번호,학점)  제2정규형(o)
학생_4(학번, 학년)  제2정규형(o)
과목_1(과목번호, 과목개설학과, 학과장)  제2정규형(o)
```

### 제2정규형의 문제점

![database15](/assets/images/2023-12-07/database15.jpeg)

- (2-1) 삽입 이상

  - 과목개설학과인 '통계'학과의 학과장이 '홍장미'라는 사실만 따로 삽입할 수가 없음

- (2-2) 수정 이상

  - 컴퓨터학과의 학과장이 '박유찬'에서 '홍길동'으로 변경될 경우, 여전히 과목개설학과 '컴퓨터'인 모든 튜플을 찾아 '학과장' 속성 값을 한꺼번에 '홍길동'으로 변경해야 함

- (2-3) 삭제 이상
  - 과목번호 'c002'의 등록을 취소하여 이 튜플을 삭제하면 '경영'학과의 학과장이 '김철수'라는 원하지 않은 정보까지 함께 삭제됨

### 제2정규형의 문제점 해결

- 제2정규형을 충족하는 '과목\_1' 릴레이션에 삽입(2-1), 수정(2-2), 삭제(2-3) 이상이 발생하는 이유

  - 아직도 둘 이상의 의미적 연관성을 하나의 릴레이션으로 함께 표현했기 때문

- 이행적 함수 종속성(transitive functional dependency)
  - 기본키에 속하지 않은 일반 속성 값이 기본키에 속하지 않은 또 다른 일반 속성 값을 결정함
  - 해결방법: 이행적 종속 관계를 끊어 두 종속 관계를 각기 다른 릴레이션에 표현 즉, 2개의 릴레이션으로 분해함

![database16](/assets/images/2023-12-07/database16.jpeg)

### 3.4 제3정규형

- 제3정규형 정의

```
제3정규형(3NF): 어떤 릴레이션 R이 제2정규형이고 기본키에 속하지 않는 모든 속성이 기본키에 이행적 함수 종속이 아니면, 제3정규형(Third Normal Form)에 속한다.
```

- 제3정규형은 제2정규형을 충족하는 릴레이션의 기본키가 아닌 일반 속성이 결정자인지를 검사

- 일반 속성이 기본키 속성이 아닌 일반 속성에 종속적일 때 제3정규형에 위배됨

```
수강_3(학번, 과목번호, 학점)  제3정규형(o)
학생_4(학번, 학년)  제3정규형(o)
과목_1(과목번호, 과목개설학과, 학과장)  제3정규형(x)
과목_2(과목번호, 과목개설학과)  제3정규형(o)
과목_3(과목개설학과, 학과장)  제3정규형(o)
```

![database17](/assets/images/2023-12-07/database17.jpeg)

- (3-1) 삽입 이상

  - 과목번호 'c004'의 강의담당교수가 'p005'이라는 사실만 따로 삽입할 수는 없음

- (3-2) 수정 이상

  - 강의담당교수 'p001'의 담당 과목번호가 'c005'로 변경될 경우, 'p001'과 관련된 모든 튜플을 찾아 '과목번호' 속성 값을 한꺼번에 'c005'로 변경해야 함

- (3-3) 삭제 이상
  - 학번 's002'인 학생이 교과번호 'c002'의 수강을 취소하여 이 튜플을 삭제하면 'p002' 교수가 'c002' 과목을 강의한다는 정보까지 함께 삭제됨

### 제3정규형의 문제점 해결

- 제3정규형을 충족하는 '수강\_4' 릴레이션에 삽입(3-1), 수정(3-2), 삭제(3-3) 이상이 발생

  - 원인: 기본키가 아닌 속성이 기본키 일부 속성의 결정자가 되기 때문

- 이러한 문제를 해결하려면 기본키가 아닌 결정자를 분리하여 2개의 릴레이션으로 분해

![database18](/assets/images/2023-12-07/database18.jpeg)

![database19](/assets/images/2023-12-07/database19.jpeg)

![database20](/assets/images/2023-12-07/database20.jpeg)

### 3.5 보이스코드 정규형

- 보이스코드 정규형(BCNF: Boyce Codd Normal Form)의 정의
  - 복잡한 식별자 관계에 의한 문제를 해결하기 위해 제3정규형을 보완
  - "강한 제3정규형(strong 3NF)"이라고도 함

```
보이스코드 정규형(BCNF): 릴레이션 R의 모든 결정자(determinant)가 후보키(candidate key)이면 릴레이션 R은 보이스코드 정규형에 속한다.
```

![database21](/assets/images/2023-12-07/database21.jpeg)

C가 A 또는 B의 결정자가 되는 경우,

- 후보키는 (A,B)
- 후보키가 아닌 C가 A 또는 B를 결정하면 안됨

![database22](/assets/images/2023-12-07/database22.jpeg)

### 3.6 정규화의 적용

- 정규화
  - 릴레이션을 정보 표현 측면에서 동등하면서도 중복을 감소시키는 더욱 작은 릴레이션들로 무손실 분해함으로써 이상 현상을 제거하는 데이터베이스 설계의 한 방법

![database23](/assets/images/2023-12-07/database23.jpeg)

### 반정규화

- 반정규화(de-normalization)
  - 정규화의 반대 개념, '역정규화'
    - 정규화와는 반대로 보다 낮은 수준의 정규형으로 릴레이션을 통합
    - 성능 저하가 문제될 경우 분해된 릴레이션을 역으로 통합, 성능을 향상시키는 설계 방법
  - 높은 정규형을 만족하는 릴레이션 스키마가 반드시 최적이라고 할 수는 없음
    - 정규화는 데이터의 정합성과 무결성이 강화되는 장점이 있지만 반대로 릴레이션 수가 과다하게 늘어나 SQL 문장이 복잡해지고 조인 연산 등으로 실행 시간이 오래 걸릴 수도 있기 때문
    - 자주 또 다량으로 조회되는 데이터에 대해서는 역으로 데이터 중복을 허용하는 반정규화 수행 가능
  - 반정규화는 다음 과정을 포함
    - 릴레이션들을 병합
    - 통계 \* 이력 릴레이션을 추가
    - 여러 릴레이션에 같은 속성을 중복하여 추가
    - 총계 \* 평균 같은 파생 속성을 추가
  - 반정규화는 데이터베이스 설계의 최종 단계에서 신중하게 고려

## E-R 모델

### 1. E-R 모델

- 개체-관계 모델(Entity-Relationship model) 또는 E-R 모델

  - 1976년 피터 첸(Peter Chen)이 처음 제안
  - 현실 세계를 개체와 관계를 이용하여 개념 구조로 표현하는 대표적 개념적 모델링 방법
  - E-R 다이아그램(diagram)이라는 그래픽 기호로 표현하여 쉽게 이해할 수 있음

- E-R 다이아그램의 구성 요소
  - 기본적으로 개체를 표현하는 사각형
  - 관계를 나타내는 마름모
  - 개체나 관계의 속성을 표현하는 타원
  - 그리고 이들을 연결하는 링크(link)

![database24](/assets/images/2023-12-07/database24.jpeg)

### 1.2 개체

- E-R 다이아그램에서 현실 세계를 모델링하는 가장 중요한 요소

- 개체(entity)
  - 현실 세계에서 저장할 가치가 있는 데이터와 관련된 독립적 존재를 의미
  - 사람(학생, 교수 등), 사물(컴퓨터, 도서 등), 장소(강의실, 주차장 등)와 같은 물리적 존재뿐만 아니라 추상적 개념(과목, 학과) 등이 해당
  - 개체는 개체의 특성을 나타내는 속성에 의해 구별

![database25](/assets/images/2023-12-07/database25.jpeg)

- 데이터베이스 관점에서는 각 개체 정보의 저장 구조를 구성하는 것이 중요하므로 개체의 공통된 특성을 모아 구조를 정의

- E-R 다이아그램에서 사각형 기호로 표시
  - 다른 개체와 구별되는 고유한 개체 이름과 하나 이상의 속성으로 정의
  - 개체의 속성은 개체 고유의 특성이나 상태 정보를 표현
  - 사각형 안에 개체 이름을 표기, 속성은 타원형 기호로 표시하여 사각형에 링크로 연결

### 개체와 개체 타입, 개체 집합

- 개체와 개체 타입, 개체 집합의 차이점
  - 개념 데이터 모델링 과정에서 개체(entity)와 개체 타입(entity type), 개체 집합(entity set) 3가지 용어는 비슷하지만 개념적으로 다름

|                       개체(entity) 또는 개체 인스턴스                        |                         개체 집합(entity set)                          |            개체 타입(entity type)             |
| :--------------------------------------------------------------------------: | :--------------------------------------------------------------------: | :-------------------------------------------: |
| 데이터베이스 관점에서 관심을 갖는 현실 세계의 특정 존재 하나하나를 의미한다. |             공통된 속성을 갖는 개체들을 모아놓은 그룹이다.             | 같은 속성을 갖는 개체 집합의 추상적 표현이다. |
|                    예) '홍길동', '18413', '데이터베이스'                     | 예) {홍길동, 홍장미, 홍미림}, {18413, 18221}, {데이터베이스, 자료구조} |           예) 학생, 강의실, 교과목            |

- 개체와 개체 타입, 개체 집합의 예

![database26](/assets/images/2023-12-07/database26.jpeg)

### 1.3 속성

- 속성(attribute)
  - 개체 또는 관계가 갖는 고유한 특성
  - 스스로 존재할 수 없는 종속적 개념
  - 개체나 관계와 연결되어 가장 작은 정보 단위로서 중요한 의미를 표현
  - 타원형 기호로 표현하며 타원 안에 고유한 속성 이름을 표기, 직사각형이나 마름모 기호와 실선으로 연결

![database27](/assets/images/2023-12-07/database27.jpeg)

### 속성 유형

1. 단일 값 속성과 다중 값 속성

- 특정 속성이 갖는 값이 하나이면 단일 값 속성(single-valued attribute)
- 만약 개체가 갖는 속성 값이 여러 개이면 다중 값 속성(multivated attribute)

![database28](/assets/images/2023-12-07/database28.jpeg)

2. 단순 속성과 복합 속성

- 단순 속성(simple attribute): 의미적으로 더 이상 분해할 수 없는 속성
  - 기본 속성으로 대부분의 속성이 이에 속함
- 복합 속성(composite attribute): 둘 이상의 속성으로 이루어져 의미적으로 더 작은 단위로 분해가 가능한 속성
  - 타원 모양의 상위 속성과 하위 속성을 실선 링크로 연결
  - 단순 속성은 의미가 하나이지만 복합 속성은 여러 의미를 포함

![database29](/assets/images/2023-12-07/database29.jpeg)

3. 저장 속성과 유도 속성

- 저장 속성(stored attribute): 실제 값을 저장하는 속성
- 유도 속성(derived attribute): 값을 저장하지 않아도 다른 속성 값에서 계산되거나 유도될 수 있는 속성

![database30](/assets/images/2023-12-07/database30.jpeg)

4. 키 속성

- 키 속성(key attribute): 각 개체를 유일하게 식별할 수 있는 고유한 값을 갖는 속성

![database31](/assets/images/2023-12-07/database31.jpeg)

### 속성의 종류

![database32](/assets/images/2023-12-07/database32.jpeg)

### 1.4 관계

- 관계(relationship)

  - 개체와 개체 사이에 맺어지는 연관성을 의미
  - 주로 저장 가치가 있는 데이터를 발생시키는 의미 있는 연관성을 표현
  - 관계는 개체 없이는 존재할 수 없는 종속적 존재
  - 거래(등록, 구매, 예약 등), 행위(치료, 상담, 수강 등), 신분(소속, 관리 등)과 같은 물리적, 추상적 개념들이 해당
  - '관계성'이라고도 하며 관계 이름과 필요한 속성들로 정의

- E-R 다이아그램에서 마름모 기호로 표시
  - 보통 둘 이상의 개체와 실선으로 연결
  - 관계의 속성은 각 관계를 맺음으로써 발생하는 특성 정보를 표현
  - 마름모 기호 안에 관계 이름(정확하게는 관계 타입)을 표기하고 타원형 기호로 표시되는 속성을 마름모에 실선으로 연결

### 1.5 관계의 유형

- 분류기준 1: 관계 카디널리티(relationship cardinality)
  - 관계를 맺는 두 개체 집합 간의 사상(mapping) 형태를 정의
  - 두 개체 집합이 서로 관계를 맺을 때 각 개체 인스턴스에 사상되는 상대 개체 인스턴스의 개수가 기준이 됨

1. 최대 사상 수

- 특정 개체와의 관계에 실제 참여하는 상대 개체의 수 중에서 최대값을 표현
- 최대값은 1 또는 다수(many)를 의미하는 m(혹은 n)으로 표기
- 일대일 (1:1)
  - 두 개체가 서로 오직 하나의 개체와만 관계를 맺을 수 있다면 일대일 관계

![database33](/assets/images/2023-12-07/database33.jpeg)

### 관계의 유형(최대 사상 수)

- 일대다(1:n)
  - 한 개체는 여러 개체와 관계를 맺을 수 있지만 상대 개체는 많아야 하나의 개체와만 관계를 맺을 수 있다면 일대다 관계

![database34](/assets/images/2023-12-07/database34.jpeg)

- 다대일(n:1)
  - 한 개체는 최대 하나의 개체와 관계를 맺을 수 있지만 상대 개체는 여러 개체와 관계를 맺을 수 있다면 다대일 관계

![database35](/assets/images/2023-12-07/database35.jpeg)

- 다대다(m:n)
  - 두 개체가 서로 여러 개체와 관계를 맺을 수 있다면 다대다 관계

![database36](/assets/images/2023-12-07/database36.jpeg)

### 관계의 유형(최소 사상 수)

- 특정 개체와의 관계에 실제 참여하는 상대 개체의 수 중에서 최소값을 표현

- 최소값이 1인 경우(전체 참여)
  - 만약 개체가 적어도 하나 이상의 개체와 반드시 관계를 맺어야 한다면 최소 사상 수는 1

![database37](/assets/images/2023-12-07/database37.jpeg)

- 최소값이 0인 경우(부분 참여)
  - 만약 개체가 다른 개체와 관계를 맺을 수도 혹은 맺지 않을 수도 있다면 최소 사상 수는 0

![database38](/assets/images/2023-12-07/database38.jpeg)

### 관계의 유형(관계차수)

- 분류기준2: 관계 차수(relation degree)

  - 관계에 참여하는 개체의 수

- 1진 관계 또는 순환(recursive) 관계
  - 차수가 1이며 개체가 자기 자신과 스스로 맺는 관계

![database39](/assets/images/2023-12-07/database39.jpeg)

- 2진 관계
  - 차수가 2인 가장 일반적인 관계 유형이다. 두 개의 개체가 서로 맺는 관계

![database40](/assets/images/2023-12-07/database40.jpeg)

- 3진 관계
  - 3개의 개체가 함께 맺는 관계

![database41](/assets/images/2023-12-07/database41.jpeg)

### 관계의 유형(관계 종속성)

- 분류기준3: 관계의 종속성

1. 비식별 관계와 식별 관계
   - 비식별 관계(non-identifying relationship)
     - 보통 독립적인 두 개체가 대등한 관계를 맺을 때 실선 마름모로 표시
   - 식별 관계(identifying relationship)
     - 두 개체가 대등한 관계가 아닌 종속적 관계를 맺는 경우 이중 실선 마름모로 표시

![database42](/assets/images/2023-12-07/database42.jpeg)

- '부양가족' 개체는 '직원' 개체에 존재 종속(existence dependence)
- 강 개체(strong entity): 자신을 고유하게 식별할 수 있는 속성을 갖는 개체
- 약 개체(weak entity): 자신을 고유하게 식별할 수 있는 속성을 갖지 못하는 개체
  - 강 개체에 종속되는 약 개체는 독립된 존재가 아니므로 고유한 식별 속성을 갖지 못함
  - 대신 키의 일부가 될 수 있는 부분키(partial key) 속성만을 가지며 점선 밑줄로 표시

2. 일반화(generalization) 관계

- 개체 사이의 상하 관계
- 'IS-A 관계' 라고도 하며 역삼각형으로 표현
- 역삼각형 위로는 상위 개체(supertype entity)를, 아래에는 하위 개체(subtype entity)를 실선으로 연결
  - 상위 개체는 하위 개체들이 공통으로 갖는 속성을 표현
  - 하위 개체는 공통 속성 이외에 추가로 갖는 고유 속성만을 표현
  - 상위 개체의 속성 중에 구별자(discriminator) 역할의 속성을 포함

![database43](/assets/images/2023-12-07/database43.jpeg)

### 개체와 관계의 종류

![database44](/assets/images/2023-12-07/database44.jpeg)

### 2.1 E-R 다이아그램의 표기법 요약

![database45](/assets/images/2023-12-07/database45.jpeg)

![database46](/assets/images/2023-12-07/database46.jpeg)

## 데이터베이스 설계

### 1. 데이터베이스 설계

- 데이터베이스의 역할

![database47](/assets/images/2023-12-07/database47.jpeg)

- 데이터 모델링(data modeling)
  - 데이터베이스 구조를 생성하는 절차적 과정
  - 실세계를 개념화하고 논리적 구조로 추상화한 다음 물리적 테이블 구조를 컴퓨터 안에 생성하는 일련의 단계를 거쳐 데이터베이스 구조를 완성

### 데이터베이스 모델링

- 데이터 모델링 과정

![database48](/assets/images/2023-12-07/database48.jpeg)

### 1.2 데이터베이스의 설계 과정

- 반복적인 설계 과정을 통해 정제된 최종 설계 결과가 생성

![database49](/assets/images/2023-12-07/database49.jpeg)

### 2. 요구사항 분석

2.1 요구사항 명세

- 데이터베이스 설계 과정의 첫 번째 단계

  - 구축하고자 하는 데이터베이스의 구현 범위와 사용자의 범주를 결정
  - 예비 사용자들로부터 요구 사항을 수집하고 업무 처리를 위해 필요한 데이터를 분석
  - 사용자와의 인터뷰, 설문지 조사, 업무 관련 문서의 검토와 기존 시스템 또는 유사 시스템에 대한 분석 등을 포함

- 분석 결과는 요구사항 명세서로 문서화
  - 분석가는 담당자의 요구를 정확하게 파악하도록 노력하고 용어 등이 모호성이 없도록 최대한 명확하게 명세서를 정리
  - 명세서는 분석가의 자의적 해석이나 짐작이 아닌 사용자의 요구 사항만을 충실히 반영하여 구체적 문장 형태로 서술
  - 최종적인 요구사항 명세서는 사용자에게 최종 확인을 받는 과정이 필요

### 2.2 병원 DB 요구사항 명세서

- 요구사항 분석 적용 예(병원 DB)

![database50](/assets/images/2023-12-07/database50.jpeg)

### 3. 개념적 설계

- 개념적 설계(E-R 다이아그램 작성) 과정
  - 데이터베이스 설계의 전체 골격을 결정하는 과정
  - 요구사항 명세서의 내용을 기반으로 핵심적인 데이터 요소들을 추출하여 E-R 다이아그램을 작성

![database51](/assets/images/2023-12-07/database51.jpeg)

### 3.1 개체 정의

- 개체 도출

![database52](/assets/images/2023-12-07/database52.jpeg)

- 개체 정의 예

![database53](/assets/images/2023-12-07/database53.jpeg)

### 3.2 관계 정의

- 관계 도출

![database54](/assets/images/2023-12-07/database54.jpeg)

- 관계 정의 예

![database55](/assets/images/2023-12-07/database55.jpeg)

### 3.3 속성 정의

- 속성 도출

![database56](/assets/images/2023-12-07/database56.jpeg)

- 속성 정의 예

![database57](/assets/images/2023-12-07/database57.jpeg)

### 요구사항 명세서의 E-R 다이아그램 변환 규칙

- 개체, 관계, 속성 구별 방법

|            개체             |             관계             |        속성         |
| :-------------------------: | :--------------------------: | :-----------------: |
|         독립적 존재         |         종속적 존재          |     종속적 존재     |
|  명사(주어,목적어)로 표현   |     동사(서술어)로 표현      | 명사(수식어)로 표현 |
|          상위 개념          |          상위 개념           |      하위 개념      |
| 고유한 명칭(이름,번호) 보유 | 인위적 명칭(이름, 번호) 부여 |    해당사항 없음    |
|           지속적            |            일시적            |    지속적/일시적    |

### 요구사항 명세서 유의사항

- 유의 사항
  - 명세서 문장 안에서 개체를 찾아 사각형, 관계는 마름모, 속성은 타원형으로 표시
  - 의미가 중복되거나 반복되는 대상은 하나의 표준 용어로 통일하여 표시
  - 데이터와 직접적인 연관성이 낮거나 혹은 너무 일반적인 표현은 삭제(가운데줄) 표시
    - 특히, 데이터 관점에서 불필요하거나 기능 관련 표현들은 무시
- E-R 다이아그램 작성 시 유의 사항

|        불필요한 표현         |                      무시해도 좋은 이유                      |
| :--------------------------: | :----------------------------------------------------------: |
|         정보, 데이터         | 모든 특성에 관련되는 공통 표현에 해당되어 속성으로 부적절함  |
| 유지, 저장, 관리, 기록, 보관 |     데이터베이스의 일반 기능에 해당되어 관계로 부적절함      |
|    입력, 수정, 삭제, 검색    | 데이터베이스 시스템의 일반 기능으로 해당되어 관계로 부적절함 |
| 발급, 부여, 선택, 확인, 취소 | 관리자나 사용자의 소프트웨어 기능에 해당되어 관계로 부적절함 |

### 병원 DB E-R 다이아그램

![database58](/assets/images/2023-12-07/database58.jpeg)

### 4. 논리적 설계

4.1 개체 변환

- 개체는 기본적으로 하나의 릴레이션으로 변환

  - 새로 생성된 릴레이션을 E-R 다이아그램의 개체를 표현한다고 해서 개체 릴레이션(entity relation)이라고 함.
  - 생성된 개체 릴레이션은 개체 이름이 릴레이션의 이름이 됨

- 개체의 키 속성은 릴레이션의 기본키 속성으로, 일반 속성은 릴레이션의 속성으로 변환
  - 개체의 속성 이름이 릴레이션의 속성 이름이 됨

![database59](/assets/images/2023-12-07/database59.jpeg)

```
의사(의사번호, 이름, 진료과목)
```

### 4.2 관계 변환

- 일대다(1:n) 관계 변환
  - 일대다 관계 자체는 하나의 외래키 속성으로 변환한다.
  - 일대다 관계를 갖는 두 릴레이션(개체에서 변환됨)에서 '일'(1)측 개체 릴레이션의 기본키 속성을 가져와 '다'(n)측 개체 릴레이션에 `외래키 속성`으로 추가하여 포함시킨다. 추가하는 외래키 속성의 이름에 관계 이름을 포함하도록 변경 (예를 들면 '과번호'를 '소속진료과번호'처럼 변경)하면 그 의미를 명확히 할 수 있다.
  - 일대다 관계가 가지고 있던 모든 하위 속성들도 외래키를 추가한 '다'(n)측 개체 릴레이션의 속성으로 함께 변환한다.

![database60](/assets/images/2023-12-07/database60.jpeg)

```
진료과(과번호, 과이름)
의사(의사번호, 이름, 진료과목, 소속진료과번호, 배정날짜)
```

- 일대일(1:1) 관계 변환
  - 일대일 관계 자체도 일대다 관계의 경우처럼 하나의 외래키 속성으로 변환한다.
  - 한쪽 개체 릴레이션의 기본키 속성을 가져와 다른 쪽 개체 릴레이션에 외래키 속성으로 포함시킨다. 어느 쪽 릴레이션에 `외래키`를 추가하더라도 상관 없다.
  - 일대일 관계가 갖고 있던 모든 속성들도 외래키를 추가한 릴레이션의 속성으로 함께 변환한다.

![database61](/assets/images/2023-12-07/database61.jpeg)

```
<방법1>
환자(주민등록번호, 전화번호, 이름, 나이, 간병인전화번호, 간병일수)
간병인(전화번호, 이름, 경력연수, 간병환자주민등록번호)

<방법2>
환자(주민등록번호, 전화번호, 이름, 나이, 간병인전화번호, 간병일수)
간병인(전화번호, 이름, 경력연수)

<방법3>
환자(주민등록번호, 전화번호, 이름, 나이)
간병인(전화번호, 이름, 경력연수, 간병환자주민등록번호, 간병일수)
```

- 다대다(m:n) 관계 변환
  - 다대다 관계는 하나의 `독립된 릴레이션`으로 변환된다. 관계 이름이 새로운 릴레이션의 이름이 된다.
  - 관계의 속성은 릴레이션의 속성으로 변환된다. 관계 속성 이름이 새로운 릴레이션의 속성 이름이 된다.
  - 새로 생성된 릴레이션을 E-R 다이어그램의 관계를 표현한다는 의미에서 `관계 릴레이션(relationship relation)`이라고 한다. 관계 릴레이션은 보통 키 속성이 없으므로 관계를 맺고 있던 양쪽 개체 릴레이션의 기본키 속성을 외래키 속성으로 포함시키고 양쪽 기본키의 조합을 새로운 기본키로 지정한다. 양쪽 기본키 속성의 이름이 같을 경우, 이름을 다르게 변경한다.

![database62](/assets/images/2023-12-07/database62.jpeg)

```
의사(의사번호, 이름, 진료과목)
진료(의사번호, 환자주민등록번호, 진료날짜, 진료내용)
환자(주민등록번호, 전화번호, 이름, 나이)
```

### 4.3 병원 DB 논리적 스키마 작성

- 병원 DB의 논리적 데이터베이스 스키마

![database63](/assets/images/2023-12-07/database63.jpeg)

## 데이터웨어하우스와 데이터베이스 응용

### 1. 데이터웨어하우스 개념

- 데이터웨어하우스의 출현 배경
  - 정보의 위기(information crisis)
    - 저장된 방대한 양에 비해 실제 의사 결정에 활용할 수 있는 정보는 매우 제한적임
    - '풍요속의 빈곤'처럼 데이터는 넘쳐나는데 정작 필요한 정보는 얻을 수 없음
    - 예) 거미줄(spider web) 구조

![database64](/assets/images/2023-12-07/database64.jpeg)

### 정보 시스템의 문제점

- 기존 정보 시스템이 의사 결정에 도움을 주지 못하는 구조적인 문제점

![database65](/assets/images/2023-12-07/database65.jpeg)

### 데이터웨어하우스의 등장

- 데이터베이스

  - 즉각적인 업무 처리를 위한 OLTP(On-Line Transaction Processing) 환경에 적합
  - 신속한 데이터 처리에 비해 상대적으로 데이터 분석은 느리고 많은 제한을 가짐

- 해결 방안: 업무용 데이터와 분석용 데이터의 저장소를 분리
  - 데이터베이스 - 업무 트랜잭션 처리를 위한 운영 저장소로 사용
  - 분석을 위한 새로운 저장소를 구축 => 데이터웨어하우스

![database66](/assets/images/2023-12-07/database66.jpeg)

### 1.2 데이터웨어하우스의 정의 및 특성

- 데이터웨어하우스(data warehouse) 정의

  - 의사결정을 위한 효율적인 분석 기반을 제공하는 통합 데이터 저장소
  - 이질적인 데이터들의 추출, 변환, 통합 과정을 통해 구축된 거대한 분석전용 데이터 창고

- 데이터웨어하우스의 특성
  1. 주제 지향성(subject-oriented)
  - 분석 프로그램 중심의 데이터 구조
  - 분석 주제 중심으로 구성, 주제별로 요약
  - 대학의 예) 학생별, 교수별, 과목별로 다양한 분석 가능

![database67](/assets/images/2023-12-07/database67.jpeg)

- 데이터웨어하우스의 특성

  1. 주제 지향성(subject-oriented)

  - 분석 프로그램 중심의 데이터 구조
  - 분석 주제 중심으로 구성, 주제별로 요약
  - 대학의 예) 학생별, 교수별, 과목별로 다양한 분석 가능

  ![database68](/assets/images/2023-12-07/database68.jpeg)

  2. 통합성(integrated)

  - 데이터베이스 뿐만 아니라 외부 문서(웹 문서, 엑셀 문서, 텍스트 문서 등) 간의 통합을 고려해야
  - 분석을 위해서는 하나의 통일된 형식으로 변환이 필요
  - 통합 과정에서 데이터 유형과 측정 단위, 데이터의 불일치 문제 등을 해결
  - 데이터웨어하우스의 핵심이 되는 가장 중요한 특성으로 많은 시간과 노력이 필요함

  ![database69](/assets/images/2023-12-07/database69.jpeg)

  3. 시계열성(time-variant)

  - 데이터베이스 - 주로 현 시점까지의 업무 결과를 반영
  - 분석 과정 - 과거부터 현재까지 여러 시점의 데이터가 모두 의미가 있음
  - 추이 분석을 위해서는 각 시점에서의 데이터 버전 즉, 스냅샷(snapshot)을 저장하는 것이 중요함
  - 데이터웨어하우스 - 스냅샷 데이터들이 축적되는 대규모 저장소
  - 시간 흐름에 따라 원시 데이터 혹은 요약 데이터 형태로 다양하게 중복 저장

  ![database70](/assets/images/2023-12-07/database70.jpeg)

  4. 비휘발성(nonvolatile)

  - 데이터웨어하우스 - 수정이나 삭제가 거의 없는 일종의 검색 전용 데이터베이스
  - 데이터가 일단 저장되면 검색이나 추가적 적재만 발생, 갱신과 삭제는 거의 발생하지 않음

![database71](/assets/images/2023-12-07/database71.jpeg)

### 데이터베이스와 데이터웨어하우스의 비교

- 데이터웨어하우스: 의사 결정에 필요한 올바른 정보(right information)를 올바른 형식(right form)으로 적시(right time)에 제공하기 위한 저장소

- 데이터베이스와 데이터웨어하우스의 차이점

|    특성     |          데이터베이스          |           데이터웨어하우스           |
| :---------: | :----------------------------: | :----------------------------------: |
|    목적     |    정보 운영(트랜잭션처리)     |       정보 분석(의사결정지원)        |
|   사용자    | 고객지향적(실무자, 하위관리자) | 시장지향적(상위관리자,경영자,분석가) |
|  구조 설계  |   ER 모델링, 업무 중심 설계    |     차원 모델링, 주제 중심 설계      |
|    대상     |       현재 데이터(동적)        |        최근/과거데이터(정적)         |
|    접근     |      읽기/쓰기(수정가능)       |    읽기 전용(수정불가, 비휘발성)     |
|    관점     |          상세, 평면적          |            요약,다차원적             |
| 처리 튜플수 |            수백 건             |              수백만 건               |
|  사용자수   |            수천 명             |               수백 명                |
|  응답시간   |            초 단위             |               분 단위                |
|    용량     |        메가/기가 바이트        |           기가/테라 바이트           |
|  갱신주기   |          지속적 갱신           |             주기적 갱신              |
|    처리     |         OLTP(운영환경)         |            OLAP(분석환경)            |

### 1.3 데이터웨어하우스 시스템

- 데이터웨어하우스 시스템의 구조: 3-계층 구조(3-tier architecture)

![database72](/assets/images/2023-12-07/database72.jpeg)

### 데이터웨어하우스 구축 방식

- 상향식

  - 소규모의 데이터 마트(data mart)들을 순차적으로 먼저 구축한 후 나중에 이를 통합하여 전사적 데이터웨어하우스(enterprise data warehouse)를 완성하는 방식

- 하향식

  - 먼저 전사적 데이터웨어하우스를 구축한 뒤, 필요할 경우 순차적으로 데이터 마트를 하나씩 추가하여 전체 시스템을 완성하는 방식

- 절충식
  - 기획과 설계는 하향식 구축 방식으로 하고 실체 구축은 상향식 구축 방식처럼 가장 우선시 되는 중요한 분야부터 진행하는 방법
  - 전사적 관점에서 하나의 전체 데이터웨어하우스를 슈퍼 마트(super mart)라고 하는 핵심 저장 단위들로 분할하여 설계한 후, 각 슈퍼 마트들을 우선순위에 따라 독자적으로 구축해감으로써 최종적으로 전사적 데이터웨어하우스를 완성해가는 방식
  - 데이터 마트(data mart)
    - 조직의 일부 사용자만 사용할 목적으로 주제 범위를 제한하여 구축한 데이터 저장소
    - 데이터웨어하우스의 부분 집합으로 규모가 작아 '미니 데이터웨어하우스'로 불림
    - 분석 대상이 특정 주제로 집중되기 때문에 부서 단위의 분석 업무에 적합

### 2. 데이터웨어하우스 설계

- 다차원성

  - 다차원적인 분석을 위해서 데이터웨어하우스는 다차원 구조로 구성
  - 다차원 구조는 각 분석 관점 간의 다양한 조합에 의해 데이터에 대한 상호 연관성 분석이 가능하도록 함

- 다차원 모델링(multi-dimensional modeling)

* 높은 연관성을 갖는 데이터들을 데이터웨어하우스 안에서 다차원성을 유지하도록 구조화하는 것
* 데이터웨어하우스는 데이터베이스와는 다르게 개체와 관계가 아닌 차원 중심으로 모델링
* 다차원 모델링 방법
  - 다차원 데이터베이스: 데이터 큐브(data cube) 개념을 이용
  - 관계형 데이터베이스: 스타 스키마(star schema) 개념을 이용

### 다차원 데이터베이스

- 다차원 데이터베이스(MDB; Multi-Dimensional Database)
  - 관계형 데이터베이스의 한계점을 극복하기 위해 개발된 분석 전용 데이터베이스
  - 다차원 큐브 구조로 모델링 -> 저장소 구조 자체가 다차원 분석에 적합하도록 생성되기 때문에 복잡한 모델링이 필요 없음

![database73](/assets/images/2023-12-07/database73.jpeg)

### 다차원 질의(multi-dimensional query)

- 다차원 데이터베이스의 어느 영역을 분석하고자 하는지를 명세

  - 큐브를 자신이 원하는 모양으로 절단하여 살펴보는 것
  - 슬라이싱(slicing): 큐브의 일부분을 둘로 쪼개어 자신이 원하는 큐브 단면을 분석하는 것
  - 다이싱(dicing): 큐브 중에서 보고자 하는 부분만을 선별함으로써 작은 부분 큐브 형태의 영역을 분석하는 것
  - 피보팅(pivoting): 큐브의 축 위치를 바꾸어 같은 분석 결과를

- 다차원 질의의 기본 유형

![database74](/assets/images/2023-12-07/database74.jpeg)

### 다차원 모델

1. 데이터 큐브(data cube)

- 다차원 모델의 기본 구조, 보통 2차원 면들로 조합된 다면체 도형으로 표현
- 차원(dimension): 데이터 큐브의 각 축
- 차원 멤버(dimension member): 축 좌표
- 축 좌표들의 조합으로 큐브 안의 특정 셀(cell)을 지정하고 큐브 셀 안에는 하나의 측정값(measure)이 저장됨
- 데이터 큐브는 n개의 차원성을 갖는 데이터들을 n-차원의 큐브 구조로 모델링
- N차원의 큐브의 예

![database75](/assets/images/2023-12-07/database75.jpeg)

2. 차원(dimension)

- 데이터에 대한 하나의 분석 관점 또는 분석 시각을 표현
- 분석 관점이 다양하고 데이터 간의 상호 연관성이 높을수록 차원의 개수는 증가
- 각 차원은 하나의 축으로 표현되기 때문에 차원의 개수에 따라 큐브의 구조가 결정
- 같은 축을 구성하는 차원 멤버들은 유사한 일련의 항목들이거나 유사하지만 수준이 다른 항목들임

3. 개념 계층(concept hierarchy)

- 같은 차원 안의 수준들 간의 수직적 상하 관계
- 상위 수준의 개념으로부터 하위 수준의 개념으로 차원 멤버들을 계층적으로 조직화

![database76](/assets/images/2023-12-07/database76.jpeg)
