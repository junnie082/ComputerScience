# Network 2

# Chapter 02 네트워크 계층(1)

#### 2024.04.17.(수)

### 2.1 네트워크 계층 서비스

- 패킷화(packetizing)
- 포워딩(forwarding)과 라우팅(routing)
- 흐름(flow)제어, 오류(error)제어, 혼잡(congestion)제어

![12](/assets/images/2024-04-17/12.png)

### 2.1.1 패킷화(Packetizing)

- 패킷화

  - 출발지(source)에서 유료부하(payload)를 네트워크 계층 패킷에 캡슐화
  - 목적지(destination)에서 네트워크 계층 패킷으로부터 유료부하를 역캡슐화(decapsulating)

- 네트워크 계층은 출발지에서 목적지까지 유료부하를 바꾸거나 이용하지 않고, 목적지까지 날라주는 임무 수행

### 캡슐화

헤더(Header)와 푸터(Footer) (Trailer, 트레일러) 추가

Application program -> | TCP header | Application data | : TCP segment -> | IP header | TCP header | Application data |: IP packet -> | Ethernet header | IP header | TCP header | Application data | Ethernet footer |: Ethernet frame

### 분할(Segmentation)

: SDU(Service Data Unit), PCI(Protocol Control Identifier), PDU(Protocol Data Unit)

![13](/assets/images/2024-04-17/13.png)

### 2.1.2 라우팅과 포워딩

- 라우팅 테이블을 만들고 유지하는 3 프로세스
  - 다양한 라우팅 프로세스
    - RIP, OSPF, BGP, IS-IS 등의 라우팅 프로토콜을 동작시키는 프로세스
  - 라우팅 테이블
    - 라우팅 프로세스의 입력을 받고, 포워딩 프로세스의 정보 요청에 응답하는 프로세스
  - 패킷 전송 결정을 위해 라우팅 테이블 정보 요청을 하는 프로세스

![14](/assets/images/2024-04-17/14.png)

### 2.2 패킷 스위칭

- 라우터는 입력 포트와 출력 포트(들)간에 연결을 제공하는 스위치

  - 전시 스위치는 입력과 출력을 연결시켜 전기를 흐르게 함

- 2가지 접근 방식
  - 데이터그램(datagram) 방식
  - 가상회선(virtual-circuit) 방식

### 2.2.1 데이터그램 방식

- 네트워크 계층은 비연결형 프로토콜
- 각각의 패킷은 서로 독립적으로 처리됨
  - 각각의 패킷은 다른 패킷과 관련이 없음
- 하나의 메세지가 패킷으로 나누어 목적지로 전달될 때, 각각의 패킷은 동일 경로, 혹은 다른 경로를 통해 전달될 수 있다.

![15](/assets/images/2024-04-17/15.png)

### 2.2.2 가상회선 방식

- 연결지향 서비스(가상회선 방식)에서는, 하나의 메세지에 속하는 모든 패킷은 서로 연관이 있음

- 메세지의 데이터그램을 보내기 전에, 데이터그램 경로를 위한 가상 연결 경로를 설정해야 함

- 연결 설정 이후, 데이터그램은 동일 경로로 전달

- 이런 유형의 서비스에서는, 패킷은 소스와 목적지 주소뿐만 아니라, 패킷이 흐르는 가상 회선을 정의하는 가상 회선 식별자인 흐름 레이블이 필요함

![16](/assets/images/2024-04-17/16.png)

![17](/assets/images/2024-04-17/17.png)

![18](/assets/images/2024-04-17/18.png)

### 2.3 네트워크 계층 성능

- 네트워크의 성능은 지연(delay), 수율(throughput), 그리고 패킷 손실(loss)로 측정
- 혼잡제어(체증제어)는 성능을 개선하는 큰 이슈

### 2.3.1 지연

- 전송(Transmission)지연: 패킷을 보내는 데에 걸리는 시간
  - 전송지연 = 패킷길이 / 전송속도
- 전파(Propagation)지연: 신호가 목적지까지 가는 데에 걸리는 시간
  - 전파지연 = 거리 / 전파속도(20만km / 초)
- 처리(Processing) 지연: 라우터와 목적지에서 처리 시간
- 큐잉(Queuing) 지연: 시스템에서 처리를 받기 전까지 기다리는 시간(input queue, output queue)

### 2.3.2 Throughput (수율)

- 네트워크 한 지점에서의 쓰루풋은
  - 그 지점을 초당 통과하는 비트수
  - 그 지점에서의 전송 속도보다 낮은 값
    - 에러나는 경우 줄어듦
    - 여러 링크를 거치는 경우 최소 밴드폭값 이하로 됨

### 2.3.3 패킷 손실

- 버퍼의 크기는 유한
- 버퍼가 꽉 차면 이후의 패킷은 버려짐(overflow)
- 버려지면 재전송을 해야 하는데, 이 경우 상황이 더 악화될 수 있음

### 2.3.4 혼잡제어

- 인터넷 모델에서 네트워크 계층에서의 혼잡(제어)는 명확히 정의되지 않음
- 네트워크 계층 혼잡 이슈: 쓰루풋, 지연
- 혼잡 제어 방식
  - Open-loop 혼잡 제어(사전예방)
    - 송신자/수신자가 혼자 제어
  - Closed-loop 혼잡 제어(발생후 제거)
    - 상호 교신을 통한 제어

![19](/assets/images/2024-04-17/19.png)

### Open-loop 혼잡 제어

- 재전송 정책
  - 재전송은 혼잡을 더 심하게 만듦. 재전송 정책과 재전송 타이머를 효과적으로 조절
- 윈도우 정책
  - Selective-repeat가 Go-Back-N 보다 효과적
- 확인응답 정책
  - 확인응답을 데이터와 같이 보내거나, 하나로 여러 패킷 확인응답
- 버림 정책
  - 혼잡 발생 초기에 패킷을 버리면 혼잡 발생 예방 가능
- 수락 정책
  - 가상회선 방식에서 활성 회선수를 제한

### Closed-Loop 혼잡 제어

- Backpressure

  - 혼잡 발생시 전 노드에게 보내지 말도록 요구
  - 데이터그램 네트워크에서는 안됨

- Choke packet

  - 혼잡 발생시 소스 노드에게 직접 보내지말도록 요구
  - ICMP 같은 특수패킷을 따로 만들어 보내는 방식

- 암시적 시그널링

  - 확인응답이 늦게 오면 혼잡임을 감지하고 트래픽량 줄임
  - TCP 혼잡제어 방식

- 명시적 시그널링
  - 혼잡노드에서 소스나 목적지에게 직접 신호를 보내는 방식
  - 패킷 내의 특정 필드에 혼잡임을 표시하여 알리는 방식

![20](/assets/images/2024-04-17/20.png)
