# 파이프 라이닝

#### 2024.12.05.(목)

## 파이프 라이닝

### [파이프라이닝이란?](https://jokerkwu.tistory.com/120#google_vignette)

명령어를 순차적으로 실행하는 프로세서에 적용되는 기술로, 한 번에 하나의 명령어만 실행하는 것이 아니라 하나의 명령어가 실행되는 도중에 다른 명령어를 실행을 시작하는 식으로 동시에 여러 개의 명령어를 실행하는 기법이다.

이렇게 `동시에 여러 개의 명령어를 처리함으로써 처리량을 올리는 것`이 파이프라이닝의 핵심이다.
모든 단계는 원래의 동작 속도대로 일을 하면서 처치량을 늘리는 것이지 원래의 동작 속도를 단축시키는 것은 아니다.

세탁소에서 다음과 같은 순서로 일을 한다고 가정해 보겠다.

과정 1: 빨래를 세탁기에 넣는다.
과정 2: 세탁기를 동작시킨다.
과정 3: 건조기를 동작시킨다.
과정 4: 빨래를 갠다.

세탁물 1, 2, 3에 대해서 동시에 처리할 수 없으므로 모든 작업을 마치는데 클럭이 12가 필요하지만

파이프라이닝 유사한 기법을 적용하면 아래와 같이 처리가 가능하다.

그림과 같이 세탁물을 동시에 처리가 가능하므로 총 클럭이 6개만 필요하다.
매 클럭마다 여러 명령어를 중복된 단계 없이 처리한다.
그림 (2)에서처럼 각 처리부는 독립적으로 동작하므로 클럭 주기 4에서 과정 4, 과정 3, 과정 2, 과정 1을 실행할 수 있다. 즉, 최대 4개의 명령어를 동시에 실행할 수 있다.

명령어를 세분화 할수록 처리 속도 향상을 기대할 수 있다. (하지만, 실행할 명령어가 하나밖에 없거나 실행할 명령어 수에 비해 지나치게 단계를 세분화하게 되면 효율성을 기대하기 힘들 것이다. 하지만 일반적으로 CPU는 한 개의 명령어가 아닌 수십 개의 명령어를 함께 실행하기 때문에 효과적인 기술이 되고 있다.)

### 가장 효율적인 파이프라인 조건

- 각 단계별 처리 시간이 일정해야 한다.
- 각 명령의 처리 단계는 균일 해야 한다.

처리 시간이 일정하지도 않고 처리 단계가 균등하지 않아서 문제가 발생하는데 이를 해저드(Hazard)라고 한다.

### 해저드의 종류

1. 구조적 해저드

- 프로세서의 자원이 부족해서 발생한다.
- 아래와 같이 명령어 2에서 [실행하기]가 1클럭에 안끝날 경우, 명령어 3에서 [결과쓰기] 수행할 때 멈춤(stall)이 발생한다.
- 또한 명령어 4에서는 [해석하기] 단계가 필요 없는 명령어이므로 [실행하기]를 수행하려고 할 시 명령어 3에서 [실행하기]가 수행되고 있어 이때 또한 stall 이 발생한다.

2. 데이터 해저드

- 이전 명령어의 결과를 기반으로 다음 명령이 수행될 때 파이프라인이 지연되는 경우 생기는 것으로, 컴퓨터 파이프라인에서는 앞선 명령어에 종속성을 가질 때 데이터 해저드가 일어난다.

- 이를 해결하기 위한 방법 중 하나는 바로 `전방전달(forwarding)` 혹은 `우회전달(bypassing)`이다. 이것은 별도의 하드웨어를 추가하여 정상적으로는 얻을 수 없는 값을 내부 자원으로부터 일찍 받아오는 것을 의미하는데, 레지스터나 메모리에 아직 나타나지 않은 데이터를 기다리지 않고 데이터패스를 추가로 하드웨어에 연결하여 내부 버퍼로 부터 가져오는 것이다.

3. 제어 해저드

- 명령어의 실행 순서를 변경하는 Branch, Jump 등 분기 명령어들로 인해 다른 명령어들이 실행 중에 한 명령어의 결과 값에 기반을 둔 결정을 할 필요가 있을 때 일어난다.
- 분기 분의 경우 해당 명령어의 결과값이 나와야 다음 명령어가 수행되는데, 이때 해당 명령어가 끝날 때까지 다음 명령어가 멈춤이 발생한다. 이것을 제어 해저드라 한다.

## [파이프라이닝](https://kimtaehyun98.tistory.com/45)

파이프라이닝은 프로세서 성능에 영향을 미치는 요인 중 CPI와 관련 있다. 즉, 파이프라이닝을 통해 평균 CPI를 감소시켜 성능을 좋게 만들어준다.

### 1. 파이프라이닝 개요

세탁, 탈수, 건조, 옷장 이 4가지 과정을 거쳐 세탁을 한다고 하자.
세탁 -> 탈수 -> 건조 -> 옷장 -> 세탁 -> 탈수 -> 건조 -> 옷장 ... 과정을 거치면서 세탁을 할 수 있다.
이는 정직하게 각각의 시간을 합한 시간이 전체 세탁 시간이 된다.
