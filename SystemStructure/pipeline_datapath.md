# 파이프라인 데이터패스 및 제어

#### 2024.12.09.(월)

## [파이프라인 데이터패스 및 제어](https://chayan-memorias.tistory.com/179)

### [MIPS 명령어 파이프라인의 5단계]

1. IF(Instruction fetch): 명령어 인출
2. ID(Instruction decode): 명령어 해독 및 레지스터 파일 읽기
3. EX(Execution): 실행 및 주소 계산
4. MEM(memory): 데이터 메모리 접근
5. WB(Write back): 레지스터에 쓰기

### [단일 사이클 데이터패스의 분할]

: 앞서 보았듯이 일반적으로 정보 흐름은 왼쪽에서 오른쪽으로 진행된다. 하지만, 이 흐름 중 두 가지 예외가 있다.

1. WB 단계: 결과를 Reg 파일에 쓰기(역류): -> `데이터 해저드` 유발
2. PC의 다음 값 선정: 증가된 PC 값(IF서 처리)과 MEM 단계의 분기 주소 중에서 선택 -> `제어 해저드` 유발

### [파이프라인 데이터패스]

: 데이터패스를 위에서 나눈 5단계 기준으로 `분리`하려 한다.

- 파이프라인 레지스터: 파이프라인 단계를 `분리하는 역할` / 후속 파이프라인 단계에서 `필요한 정보를 필요단계까지 전달`

### [분리된 데이터패스 시간 흐름 순서대로 보기]

: 각 단계별 그림자로 생략

1. Iw 명령어 시간 흐름 별 수행 과정

1) IF 단계: Mux, PC, Adder, Instruction memory 활성화
2) ID 단계: Register의 Read data1, 2, Sign-extend 활성화
3) EX 단계: Mux, ALU 활성화
4) MEM 단계: Data Memory, Read data 활성화
5) WB 단계: Mux와 Register의 Write Reg, data 활성화 -> `데이터 해저드` 유발

2. sw 명령어 시간 흐름 별 수행 과정
   : lw와 유사, 하지만 `MEM 단계에서 Data Memory의 왼쪽부분만 작동 (WB 단계에선 수행하는 것 없음)`

### [그림으로 표현하는 파이프라인]

: 두 가지 방식의 표현법이 있다.

1. 시간별로 명령어마다 작동하는 부분을 칠하는 방식: but, 그리기 번거로움
2. 그냥 각 시간별로 수행되는 단계 작성

### [파이프라인 제어신호]

: 단일방식에선 10개의 신호 동시에 발사했지만, 파이프라인 도입으로 인해 이제는 `부분별로 제어신호 발사` 해야 한다.

#### 각 단계별 제어 신호(제어신호를 제어하는 제어신호)

1. IF: 제어신호 없음: 항상 같은 작업 수행하기 때문에 필요없다
2. ID: 제어신호 없음: 이하동
3. EX: RegDst(rt, rd 구분), ALUOP(수행연산종류), ALUSrc(Read data2, extended16bit 중 어느 걸 피연산자로?)
4. MEM: Branch(beq), MemRead(lw), MemWrite(sw)
5. WB: MemtoReg, RegWrite (rw, lw 일때만 활성화)

#### 각 단계에서 명령어에 따라 각 제어신호들에게 내보내주는 신호

#### 파이프라인 레지스터를 통한 제어신호의 전달

: 제어신호가 Ex -> MEM -> WB 거치면서 `각자에 필요한 정보는 쓰고 나머지는 다음꺼에 전달하는 방식`
