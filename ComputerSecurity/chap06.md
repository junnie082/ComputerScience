# Computer Security

## 6장. 네트워크보안 (Network Security)

#### 2024.10.22.(화)

### 목차

1. 네트워크의 이해
2. 네트워크 공격과 보안

- DoS와 DDoS
- 스니핑 공격
- 스푸핑 공격
- 세션 하이재킹 공격

3. 무선 네트워크 공격과 보안
4. 방화벽
5. 침입 탐지 시스템
6. 침입 방지 시스템

## 6-1. 네트워크의 이해

### 네트워크의 이해

- 기본개념 (용어)

  - 네트워크(Network): 두 대 이상의 컴퓨터나 장치들이 데이터를 주고받기 위해 연결된 시스템
  - 패킷(Packet): 네트워크 상에서 전송되는 데이터의 작은 단위
    .데이터를 전송할 때 패킷으로 쪼개어 보냄
  - 프로토콜(Protocol): 네트워크 상에서 데이터를 주고받기 위한 규칙과 절차를 정의
    .예) TCP/IP
  - IP 주소: 네트워크 상에서 장치를 식별하기 위한 고유한 주소
    .예) IPv4와 IPv6
  - 서브넷(Subnet): 네트워크를 여러 작은 네트워크로 나누는 방법
    .네트워크 트래픽을 효율적으로 관리하기 위해 사용
  - MAC (Media Access Control) 주소: 네트워크 인터페이스 카드 (NIC)마다 할당된 고유한 하드웨어 주소
    .로컬 네트워크에서 장치 간 통신 시 사용
  - 라우터 (Router): 서로 다른 네트워크 간의 트래픽을 관리하고 전달하는 장치
    .IP 주소를 기반으로 데이터를 전달
  - 스위치(Switch): 같은 네트워크 내에서 장치 간의 데이터 전송을 관리
    .MAC 주소를 사용해 데이터를 전달

- OSI 7계층
  - 국제표준화기구(ISO, International Organization for Standardization)는 다양한 네트워크 간의 호환을 위해 OSI 7계층이라는 표준 네트워크 모델을 만듦

7계층: 응용 프로그램 계층, 응용 프로세서와 직접 관계하여 일반적인 응용 서비스를 수행하는 계층(HTTP, FTP 등 프로토콜)

6계층: 표현 계층, 코드 간 번역을 담당하는 계층 (MIME 인코딩, 암호화)

5계층: 세션 계층, 양 끝단의 응용 프로세스가 통신을 관리하는 방법을 제공 (RPC, Socket)

4계층: 전송 계층, 양 끝단 간 신뢰 데이터를 주고받아 상위 계층이 데이터 전달의 유효성이나 효율성을 신경 쓰지 않게 해주는 계층 (TCP, UDP 프로토콜이 있는 계층)

3계층: 네트워크 계층, 여러 개의 노드를 거칠 때마다 경로를 찾아주는 계층 (라우터, IP 공유기)

2계층: 데이터 링크 계층, 두 지점 간의 신뢰성 있는 전송을 보장 (스위치, 브릿지)

1계층: 물리 계층, 실제 장치를 연결하기 위한 전기적-물리적 세부 사항 정의 (통신 케이블, 허브, 리피터)

- TCP (Transmission Control Protocol): 신뢰성 있는 데이터 전송을 보장하며, 데이터 전송 중 손실이 발생하면 재전송

- UDP (User Datagram Protocol): 신뢰성이 낮지만, 빠른 전송을 필요로 하는 데이터 전송에 사용

  - 예) 스트리밍 서비스에서 사용

- 2,3 계층에서의 패킷의 흐름

- 라우팅

  - 데이터가 네트워크를 통해 목적지까지 가는 경로를 결정하는 과정
  - 라우터는 네트워크 계층에서 작동하며, 목적지 IP 주소를 기반으로 패킷을 전달

- 3-웨이 핸드쉐이킹 (3-Way Handshaking)

1. 1단계: 두 시스템이 통신을 하기 전에, 클라이언트는 포트가 닫힌 Closed 상태며 서버는 해당 포트로 항상 서비스를 제공할 수 있도록 Listen 상태
2. 2단계: 처음 클라이언트가 통신을 하고자 하면, 임의의 포트 번호가 클라이언트 프로그램에 할당되고 클라이언트는 서버에 연결하고 싶다는 의사 표시로 Syn Sent 상태가 됨
3. 3단계: 클라이언트의 연결 요청을 받은 서버는 SYN Received 상태가 됨. 클라이언트에게 연결을 해도 좋다는 의미로 SYN+ACK 패킷을 보냄
4. 4단계: 마지막으로 클라이언트는 연결을 요청한 것에 대한 서버의 응답을 확인했다는 표시로 ACK 패킷을 서버에 보냄

- TCP 세션의 종료

1. 통신을 하는 중에는 클라이언트와 서버 모두 Established 상태
2. 통신을 끊고자 하는 클라이언트가 서버에 FIN 패킷을 보냄. 이때, 클라이언트는 Close Wait 상태가 됨
3. 서버는 클라이언트의 연결 종료 요청을 확인하고 클라이언트에게 응답으로 ACK 패킷을 보냄. 서버도 클라이언트의 연결을 종료하겠다는 의미로 FIN 패킷을 보내고 Close Wait 상태가 됨
4. 마지막으로 클라이언트는 연결 종료를 요청한 것에 대한 서버의 응답을 확인했다는 의미로 ACK 패킷을 서버에 보냄

- Whois
  국가 인터넷주소(도메인, IP주소/AS번호) 관리기관인 한국인터넷진흥원이 제공하는 인터넷주소의 등록, 할당 정보 검색 서비스를

- Whois 서버
  - 등록, 관리 기관
  - 도메인 이름
  - 목표 사이트 네트워크 주소와 IP 주소
  - 관리자, 기술 관련 정보
  - 등록자, 관리자, 기술 관리자
  - 레코드 생성 시기와 업데이트 시기
  - 주 DNS 서버와 보조 DNS 서버
  - IP 주소의 할당 지역 위치
  - 관리자 이메일 계정

| 담당 지역 | Whois 서버 | 담당 지역 | Whois 서버 |
| 유럽 | www ripe net | 호주 | Whois aunic net |
| 아시아 | www arin net | 프랑스 | www nic fr |

- DNS의 계층 구조

DNS (Domain Name System): 호스트의 도메인 이름을 호스트의 네트워크 주소로 바꾸거나 그 반대의 변환을 수행할 수 있도록 하기 위해 개발 ('전화번호부'에 비유)

예) www.google.com  
`www`: Subdomain
`google`: Second level
`com`: Top level
`.`: Root

- DNS의 서버 이름 해석 과정

## 6-2 네트워크 공격과 보안

### 1. 서비스 거부 공격

- 서비스 거부 공격(Denial Of Service: DoS)

  - 공격 대상이 수용할 수 있는 능력 이상의 정보를 제공하거나 초과시켜 동작하지 못하게 하는 공격
  - 자원 고갈 공격형, 취약점 공격형으로 분류

- 자원 고갈 공격형

  - 죽음의 핑 공격(Ping of Death)

    - 시스템을 파괴하는 데 가장 흔히 쓰인 초기의 DoS 공격
    - 네트워크에서 패킷을 전송하기 적당한 크기로 잘라서 보내는 특성을 이용한 공격
    - 네트워크의 연결 상태를 잘게 쪼개져 보내짐. 공격 대상 시스템은 대량의 작은 패킷을 수신하면서 네트워크가 마비됨
    - 점검하는 ping 명령을 보낼 때 패킷을 최대한 길게(최대 65,500 바이트) 보내면 수백 수천 개의 패킷으로 나누어져 피해 컴퓨터에 과부화 발생
    - 대응책: 시스템 패치 및 업데이트, 방화벽 설정, 네트워크 모니터링, 트래픽 제한 등

  - SYN 플러딩 공격

    - 네트워크에서 서비스를 제공하는 시스템에 걸려있는 사용자 수 제한을 이용한 공격
    - 존재하지 않는 클라이언트가 서버별로 한정된 접속 가능 공간에 접속한 것처럼 속여 다른 사용자가 서비스를 제공받지 못하게 함
    - TCP의 연결 과정인 3웨이 핸드셰이킹의 문제점을 악용한 공격
      - 마지막에 클라이언트가 서버에 다시 ACK 패킷을 보내야 하는데 보내지 않는다면 ?
      - 서버는 SYN Received 상태로 일정시간 기다려야 함
      - 공격자: 가상의 클라이언트로 위조된 수많은 SYN 패킷을 만들어 서버에 전송
        -> 서버의 가용 접속자 수를 모두 SYN Received 상태로 만듦
    - 대응책: SYN Received의 대기 시간을 줄이는 것
    - 침입 방지 시스템과 같은 보안 시스템으로도 공격을 쉽게 차단할 수 있음

  - 스머프 공격
    - ICMP 패킷과 네트워크에 존재하는 임의의 시스템으로 패킷을 확장해 서비스 거부 공격을 수행하는 것으로, 네트워크 공격에 많이 사용함
    - 다이렉트 브로드캐스트를 악용 (공격 방법은 간단함)
      - 기본적인 브로드캐스트: 목적지 IP 주소인 255 255 255 255를 가지고 네트워크의 임의의 시스템에 패킷을 보냄
      - 다이렉트 브로드캐스트(direct broadcast): 172.16.0.0 네트워크에 공격자가 브로드캐스트 하기 위해 목적지 IP 주소를 172.16.0.255와 같이 설정하여 패킷을 보냄
    - 대응책: 라우터에서 다이렉트 브로드캐스트를 차단함

> ICMP(Internet Control Message Protocol, 인터넷 제어 메세지 프로토콜)
> 네트워크 컴퓨터 위에서 돌아가는 운영체제에서 오류 메세지를 전송받는 데 주로 사용됨

- 취약점 공격형

  - Boink, Bonk, TearDrop 공격
    - 프로토콜의 오류 제어 로직을 악용해 시스템 자원을 고갈시키는 방식
    - TCP 패킷에는 각 패킷이 데이터의 어느 부분을 포함하는지 표시를 위한 시퀀스 넘버가 기록
    - 시스템 패킷 재전송, 재조합에 과부하가 걸리도록 시퀀스 넘버를 속이는 공격
    - 대응책: 이러한 공격에 의한 취약점은 패치를 통해 제거하는데 과부하가 걸리거나 계속 반복되는 패킷은 무시하고 버리도록 처리함

  1. Boink와 Bonk 공격

  - 보잉크 (Boink): 일정한 간격으로 시퀀스 번호에 빈공간 생성
  - 봉크 (Bonk): 같은 시퀀스 번호를 계속 보냄

  2. TearDrop 공격

  - Land 공격
    - 패킷을 전송할 때 출발지 IP주소와 목적지 IP주소값을 똑같이 만들어서 공격 대상에게 보내는 공격 (조작된 IP 주소값은 공격 대상의 IP여야 함)
    - 대응책
      - 운영체제의 패치
      - 방화벽 등과 같은 보안 솔루션의 패킷 필터링: 패킷의 출발지 주소와 목적지 주소의 적절성 검증

### 2. 분산 서비스 거부 공격

- 분산 서비스 거부 공격(DDoS: Distributed Denial of Service)

  - 공격 대상에 여러 대의 공격자를 분산적으로 배치하여 동시에 DoS를 발생시켜 공격하는 방법
  - DoS 공격의 상위 단계
  - 최근 발생하는 분산 서비스 거부 공격은 악성 코드와 결합된 형태가 다수

  1. PC에서 전파가 가능한 형태의 악성 코드 작성
  2. 사전에 공격 대상과 스케쥴을 정한 뒤 미리 작성한 악성 코드에 코딩
  3. 인터넷으로 악성 코드 전파하는데 전파 과정에서는 공격이 이루어지지 않도록 잠복

  - 봇넷(botnet): 좀비 PC끼리 형성된 네트워크

  4. 공격자가 명령을 내리거나 정해진 스케쥴에 따라 일제히 공격을 수행하면 대규모의 분산 서비스 거부 공격이 이루어짐

  - 분산 서비스 거부 공격의 기본 구성
    - 공격자(attacker): 공격을 주도하는 해커 컴퓨터
    - 마스터(master): 공격자에게 직접 명령을 받는 시스템으로 여러 대의 에이전트를 관리
    - 핸들러(handler) 프로그램: 마스터 시스템의 역할을 수행하는 프로그램
    - 에이전트(agent): 직접 공격을 가하는 시스템
    - 데몬(daemon) 프로그램: 에이전트 시스템의 역할을 수행하는 프로그램

- DDoS 공격의 대응
  - DDoS 공격을 100% 방어하는 것은 불가 -> 완화(Mitigation)이라는 용어를 많이 사용
  - 임계치 기반 규칙 방어: 기준치 이상의 트래픽이 발생할 경우 디도스 공격으로 탐지해 대응
  - 인증 기반 대응: 주로 봇(Bot) 기반의 자동화된 공격을 방어
  - 하이브리드 디도스 공격 대응
    .반드시 유지되어야 하는 서비스에 대해서는 초대용량 디도스 공격을 방어할 수 있는 방법이 필요
    .우리나라 금융권의 경우 금융보안원이 제공하는 서비스형 보안(SECurity-as-a-Service) 형태의 디도스 공격 대응 서비스 '스크러빙센터'의 보호 기능
    - 스크러빙 센터의 기능
      - 트래픽 분석 및 필터링
      - 자동화 및 신속한 대응을 통한 서비스 가용성 유지
      - 신뢰성: 스크러빙 센터는 여러 지역에 분산되어 있어 공격에 대한 높은 내성 제공
      - 보고 및 모니터링: 공격 발생 시 상세한 로그와 보고서 제공

### 3. 스니핑 공격

- 스니핑 공격

  - Sniff: '코를 킁킁거리다'
  - 데이터 속에서 정보를 찾는 것으로 공격 시 아무것도 하지 않고 조용히 있음 (수동적 공격)
  - 스니핑 공격자는 가지지 말아야 할 정보까지 모두 볼 수 있어야 하므로
    랜 카드의 프러미스큐어스(promiscuous) 모드를 이용해 데이터 링크 계층과 네트워크 계층의 정보를 이용한 필터링을 해제함

- 스니핑 공격자의 프러미스큐어스 모드
  - 스니핑을 수행하는 공격자는 자신이 가지지 말아야 할 정보까지 모두 볼 수 있어야 하기 때문에 2계층과 3계층 정보를 이용한 필터링은 방해물임
  - 이럴 때 2, 3계층에서의 필터링을 해제 -> 랜 카드의 모드를 프러미스큐어스 (Promicuous) 모드

* 스니핑 공격의 종류

  - 스위치 재밍 공격

    - 스위치가 MAC 주소 테이블을 기반으로 포트에 패킷을 스위칭할 때 정상적인 스위치 기능을 마비시키는 공격
    - MACOF 공격이라고도 함
    - 고가의 스위치는 MAC 테이블의 캐시와 연산자가 쓰는 캐시가 독립적으로 나뉘어 있어 스위치 재밍 공격이 통하지 않음

  - SPAN 포트 태핑 공격
    - 스위치의 포트 미러링(port mirroring) 기능을 이용한 공격
    - 포트 미러링: 각 포트에 전송되는 데이터를 미러링하는 포트에도 똑같이 보내는 것
      .침입 탐지 시스템이나 네트워크 모니터링 또는 로그 시스템을 설치할 때 많이 사용
    - 대응방법: SPAN 포트 접근 제한, 암호화 적용, 네트워크 장비 보안 패치 등

* 스니핑 공격의 탐지
  - 자신의 이름이 아닌데도 아무 이름에나 받아들여 대답하다가 교수님께 걸리는 프리미스큐어스 모드의 학생
  - ping을 이용한 스니퍼 탐지
    - 의심이 가는 호스트에 네트워크에 존재하지 않는 MAC 주소를 위장해서 ping을 보내면 스니퍼 탐지 가능
    - 존재하지 않는 MAC 주소를 사용했으므로 스니핑을 하지 않는 호스트라면 ping request를 볼 수 없는 것이 정상이기 때문
  - ARP를 이용한 스니퍼 탐지
    - 위조된 ARP request를 보냈을 때 ARP response가 오면 프러미스큐어스 모드로 설정된 것이므로 탐지 가능
  - DNS를 이용한 스니퍼 탐지
    - 일반적으로 스니핑 프로그램은 스니핑한 시스템의 IP 주소에 DNS의 이름 해석 과정인 Reverse-DNS lookup을 수행함
    - 대상 네트워크로 ping sweep를 보내고 들어오는 Reverse-DNS lookup을 감시하면 스니퍼 탐지 가능
  - 유인을 이용한 스니퍼 탐지
    - 가짜 아이디와 패스워드를 네트워크에 계속 뿌려서 공격자가 이를 이용해 접속을 시도하면 스니퍼 탐지 가능
  - ARP watch를 이용한 스니퍼 탐지
    - ARP watch는 MAC 주소와 IP 주소의 매칭 값을 초기에 저장하고 ARP 트래픽을 모니터링하여 이를 변하게 하는 패킷이 탐지되면 알려주는 툴
    - 대부분의 공격 기법은 위조된 ARP를 사용하기 때문에 쉽게 탐지 가능

### 4. 스푸핑 공격

- 스푸핑 공격

  - Spoof: '속이기'
  - 외부의 악의적 공격자가 웹사이트를 구성하여 사용자 방문을 유도, TCP/IP 구조적 결함을 이용하여 사용자 시스템 권한을 획득한 후, 정보를 빼가는 공격

- ARP 스푸핑 공격

  - ARP 스푸핑은 MAC 주소를 속이는 것
  - 로컬에서 통신하는 서버와 클라이언트의 IP 주소에 대한 데이터 링크 계층의 MAC 주소를 공격자의 MAC 주소로 속여
    -> 클라이언트에서 서버로 가는 패킷이나 서버에서 클라이언트로 가는 패킷이 공격자에게 향하게 하여 랜의 통신 흐름을 왜곡하는 공격
  - 현재 인지하는 IP와 해당 IP를 가진 시스템의 MAC 주소 목록 확인 -> ARP 테이블
  - 예방법: 공유기의 펌웨어, 운영체제와 백신을 최신 상태로 업데이트

- IP 스푸핑 공격

  - 트러스트 관계(신뢰 관계)를 맺고 있는 서버와 클라이언트를 확인한 후
  - 클라이언트에 서비스 거부 공격을 하여 연결을 끊은 뒤
  - 클라이언트의 IP 주소를 확보한 공격자는 실제 클라이언트처럼 패스워드 없이 서버에 접근

- 트러스트에 대한 이해

  - 트러스트는 도메인 사이에 설정되는 신뢰 관계
  - 서버에 미리 정보가 기록된 클라이언트가 접근하면 아이디와 패스워드 입력 없이 로그인을 허락하는 인증법
  - 사용자가 다른 도메인 자원을 사용할 수 있도록 함

- 트러스트의 방향성

  - 단방향: 트러스트 방향이 일방적으로 설정된 경우
  - 양방향: 두 개의 도메인이 서로 상대방 도메인에 대해 트러스트를 준 경우

- DNS 스푸핑 공격

  - 실제 DNS 서버보다 빨리 DNS response 패킷을 보내어 공격 대상이 잘못된 IP 주소로 웹 접속을 하도록 유도하는 공격
  - DNS 스푸핑 공격을 막으려면 중요 서버에 대해 DNS query를 보내지 않으면 되는데 이를 위해서는 중요 접속 서버의 URL에 대한 IP를 hosts 파일에 등록해야 함
  - 모든 서버의 IP를 등록하는 것은 어려워 모든 서버의 DNS 스푸핑을 막기는 어려움
  - DNS Cache Poisoning 공격, DNS 서버 변조 공격, 도메인 서버 변조 공격 등

- 정상적인 DNS

1. 클라이언트가 DNS 서버에게 접속하고자 하는 IP 주소(www wishfree com과 같은 도메인 이름)를 물어봄 (패킷은 DNS Query)
2. DNS 서버가 해당 도메인 이름에 대한 IP 주소를 클라이언트에게 보내줌
3. 클라이언트가 받은 IP 주소를 바탕으로 웹 서버를 찾아감

- DNS 공격

1. 클라이언트가 DNS 서버로 DNS Query 패킷을 보내는 것을 확인

- 스위칭 환경일 경우에는 클라이언트 DNS Query 패킷을 보내면 이를 받아야 하므로 ARP 스푸핑과 같은 선행 작업이 필요함
- 만약 허브를 쓰고 있다면 모든 패킷이 자신에게도 전달되므로 클라이언트가 DNS Query 패킷을 보내는 것을 자연스럽게 확인할 수 있음

2. 공격자는 로컬에 존재하므로 DNS 서버보다 지리적으로 가까움
   따라서 DNS 서버가 올바른 DNS Response 패킷을 보내주기 전에 클라이언트에게 위조된 DNS Response 패킷을 보낼 수 있음

3. 클라이언트는 공격자가 보낸 DNS Response 패킷을 올바른 패킷으로 인식하고, 웹에 접속

- 지리적으로 멀리 떨어져 있는 DNS 서버가 보낸 DNS Response 패킷은 버림

* DNS 스푸핑 공격에 대한 대응책

  - DNSSEC: DNS 응답에 서명을 추가하여 데이터의 무결성을 확인 -> DNS 정보 변경 방지
  - 정기적인 DNS 서버 패치 및 업데이트: DNS 서버 소프트웨어를 최신 상태로 유지하여 알려진 취약점을 악용한 공격을 방지
  - DNS 요청 검증: DNS 서버에서 요청을 검증하고, 의심스러운 요청이나 응답을 차단하여 보안 강화
  - IDS/IPS 사용: 침입 탐지 시스템(IDS) 또는 침입 방지 시스템(IPS)을 통해 비정상적인 DNS 트래픽을 모니터링/차단
  - 로컬 DNS 캐시 보호: DNS 캐시의 무결성을 확인하고, 오래된 캐시 데이터를 정기적으로 삭제하여 악성 데이터의 영향을 감소
  - VPN 사용: 공공 네트워크에서의 DNS 요청을 암호화하여 데이터의 도청이나 변조를 방지
  - 신뢰할 수 있는 DNS 서비스 사용: Google DNS, Cloudfare DNS 등 보안이 강화된 공용 DNS 서비스를 사용

* DNS Cache Poisoning (캐시 오염)

  - DNS Cash: 사용자가 웹사이트에 접속할 때마다 DNS 서버에 반복적으로 요청하지 않도록, 한 번 조회된 DNS 결과를 캐시에 저장해 다음에 빠르게 응답할 수 있게 함
  - DNS의 Resolver 캐시에 변조된 주소를 주입해 사용자가 웹페이지 접속 시 공격자가 의도한 페이지로 접속을 유도하는 주소 변조 공격

* DNS 캐시 악성 침입 프로세스

  - 공격자는 DNS 이름 서버를 가장하여 DNS 확인자에 요청을 보낸 후,
  - DNS 확인자가 이름 서버를 쿼리할 때 응답을 위조하여 DNS 캐시를 감염시킴

* 악성 침입된 DNS 캐시

* DNS Cache Poisoning 공격의 대응

==> DNSSEC(DNS Security Extension)

- DNSSEC (DNS Security Extensions)

  - DNS 데이터 대상의 데이터 위조-변조 공격을 방지하기 위한 인터넷 표준기술
  - 공개키 암호화방식(Public Key Cryptography)의 전자서명 기술을 DNS 체계에 도입 적용

- 보안침해 공격에 대한 DNSSEC이 제공하는 보안성 범위

| 공격유형 | 방어여부 | 비고 |
| 파밍 (캐시 포이즈닝) | 방어/방지 | - DNS 데이터 위-변조 방식 이용 공격에 효과적 대응 |
| 피싱 | 해당없음 | - 피싱은 유사 도메인네임 사용하지만, 데이터 위-변조에 해당하지 않음 |
| DDoS 공격 | 해당없음 | - DDoS 공격방어 매커니즘이 아님 |
| 웜바이러스에 의한 호스트 정보변조 | 해당없음 | - DNSSEC은 DNS 질의응답 절차관련 "데이터 위-변조" 방지기술 |

- 세션 하이재킹

  - 세션 가로채기라는 뜻으로 세션은 사용자와 컴퓨터 또는 두 컴퓨터 간의 활성화된 상태
  - 세션 하이재킹은 두 시스템 간의 연결이 활성화된 상태, 즉 로그인된 상태를 가로채는 것
  - 가장 쉬운 세션 가로채기
    - 누군가 작업을 하다가 잠시 자리를 비운 PC를 몰래 사용해 원하는 작업을 하는 것

- TCP 세션 하이재킹

  - TCP의 고유한 취약점을 이용하여 정상적인 접속을 빼앗는 방법
  - 서버와 클라이언트에 각각 잘못된 시퀀스 넘버를 사용해서 연결된 세션에 잠시 혼란을 준 뒤 자신이 끼어 들어가는 방식
    1. 클라이언트와 서버 사이의 패킷을 통제하고 ARP 스푸핑 등으로 통신 패킷 모두가 공격자를 지나가게 함
    2. 서버에 클라이언트 주소로 연결을 재설정하기 위한 RST reset 패킷을 보냄
       서버는 패킷을 받아 클라이언트의 시퀀스 넘버가 재설정된 것으로 판단하고 다시 TCP 3-웨이 핸드셰이킹을 수행
    3. 공격자는 클라이언트 대신 연결되어 있던 TCP 연결을 그대로 물려받음

- 세션 하이재킹 대응책
  - 텔넷과 같은 취약한 프로토콜을 이용하지 않고 SSH와 같이 세션 인증 수준이 높은 프로토콜로 서버에 접속해야 함 (SSL/TLS 암호화 등)
  - 세션 타임아웃 설정
  - IP 및 사용자 에이전트 검증: 세션 동안 사용자의 IP 주소와 사용자 에이전트를 확인하여 일치하지 않으면 세션을 종료

## 6-3 무선 네트워크 공격과 보안

### 무선 네트워크 공격과 보안

- 무선 랜

  - 유선 랜의 네트워크를 확장하려는 목적으로 사용되며 이를 위해서는 내부의 유선 네트워크에 AP (Access Point) 장비를 설치해야 함
  - 확장된 무선 네트워크는 AP를 설치한 위치에 따라 통신 영역이 결정되며 보안이 설정 되어 있지 않으면 공격자가 통신 영역 안에서 내부 사용자와 같은 권한으로 공격 가능
  - 주요 무선 랜 프로토콜

- 무선 네트워크 보안

  - 물리적 보안 및 관리자 패스워드 변경
    - AP 보호를 위한 첫 번째 사항은 물리적 보안
    - AP 신호 세기가 건물 내에 한정되도록 출력을 조정하고, 눈에 쉽게 띄지 않는 곳에 설치
    - 설치 후 기본 계정 패스워드는 반드시 재설정
  - SSID 브로드캐스팅 금지
    - 무선랜을 검색을 위한 AP 탐색 이후, 나타나는 SSID(Service Set Identifier)는 쉽게 노출되지 않도록 Hidden AP로 변경한다.

- 무선 랜 통신의 암호화

  - WEP (Wired Equivalent Privacy)
    - 무선 랜 통신을 암호화하기 위해 802.11b 프로토콜로부터 적용되기 시작 (1999)
    - 1987년에 만들어진 RC 4 암호화와 알고리즘을 기본으로 사용
    - 문제점
      - 전사공격 (Brute force Attack)에 취약
      - 짧은 길이 (24 bit)의 초기벡터(IV) 사용 위험
      - RC4 암호 안정성 깨짐

- WPA(Wi-Fi Protected Access)

  - Wi-Fi 얼라이언스에서 IEEE 802.11i 표준이 출시될 때까지 취약한 WEP을 대신하기 위해 2002년에 발표한 암호화 규격
  - 강화된 보안: WEP 보다 더 강력한 암호화 기술을 사용 데이터 전송 보호
    .TKIP(Temporal Key Integrity Protocol)를 사용하여 동적으로 키를 생성
  - WPA-PSK와 WPA-EAP로 구분
    [WPA-Personal: WPA-PSK]
    - 사전 공유 방식 (Pre-Shared Key)을 이용한 인증 방식
    - 인증 서버가 필요하지 않으며 AP와 단말기 간 키를 공유
    - 개인이나 소규모 사무실에서 사용하도록 설계 (주로 TKIP 암호화를 사용)
      [WPA-Enterprise: WPA-EAP]
    - 802.1x/EAP를 사용하여 인증 서버(AAA)를 통해 인증 받는 방식
    - 사용자 별로 다른 키를 사용하므로 기업 환경에 필수적인 높은 수준의 보안을 지원

- WPA2 (2004)

  - AES-CCMP128 암호화 프로토콜을 사용, TKIP는 암호화 방식에서 제외
  - 인증: PSK를 주로 사용, 악의적인 사용자가 비밀번호를 추측할 수 있는 가능성
  - 공용 Wi-Fi 네트워크에서 데이터가 암호화되지 않음 (취약함)

- WPA3 (2018)

  - 암호화는 WPA2와 동일한 AES-CCMP128를 사용, 기업용 192 비트 보안에서는 더 강력한 GCMP256을 사용
  - 인증: SAE(Simultaneous Authentication of Equals) 인증 방식 사용 - 비밀번호 추측 공격(무차별 대입 공격)에 대한 저항력을 높임
  - OWE(Opportunistic Wireless Encryption)를 통해 공용 네트워크에서도 개별 연결을 암호화하여 보안을 강화

- 무슨 네트워크 공격
  - 무선 랜 인증 우회

1. 정상적인 무선랜 접속 상황
2. MAC 주소 스니핑을 통한 획득
3. 공격으로 대상 PC 접속 차단
4. 공격자의 MAC 주소 변경
5. 공격자의 무선랜 접속 성공

- WEP 암호 크랙
  - 키스트림을 재사용하는 취약점이 있음
  - 일정 평문을 얻고 암호문을 만드는 IV에 대한 키스트림 테이블을 생성할 수 있음
  - 2004년 발표된 802 11i 표준에서 IEEE는 WEP를 사용중단(deprecated) 선언

* 무선 네트워크 공격

  - DDoS, Man in the Middle Attack, Spoofing, Sniffing 등 (기존 유선 네트워크 공격)
  - 악성 AP(악성 액세스 포인트): 공격자가 합법적인 AP처럼 보이게 하는 가짜 AP를 설정하여 사용자의 접속을 유도한 후 데이터를 탈취

* 무선랜 보안 기법
  - 네트워크 암호화: 무선 네트워크 데이터를 WPA2 또는 WPA3로 암호화
  - SSID 숨기기: 네트워크 이름(SSID)을 숨겨서 공격자가 쉽게 네트워크를 탐색하지 못하도록 함
  - 강력한 비밀번호: WPA2/3 보안을 사용하는 무선랜에서는 복잡한 비밀번호 설정
  - 팜웨어 업데이트: 무선 AP와 라우터의 펌웨어를 최신 상태로 유지

## 6-4 방화벽

### 방화벽

- 방화벽

  - 네트워크 트래픽을 모니터링하고 정해진 보안 규칙을 기반으로 특정 트래픽의 허용 또는 차단을 결정하는 네트워크 보안 디바이스
  - 신뢰하지 않는 외부 네트워크와 신뢰하는 내부 네트워크 사이를 지나는 패킷을 미리 정한 규칙에 따라 차단하거나 보내주는 기능을 하는 하드웨어나 소프트웨어를
  - 내부 네트워크의 보안을 제공하기 위한 가장 기본적인 솔루션

- 방화벽의 기능
  - 접근 제어
    - 관리자가 통과시킬 접근과 거부할 접근을 명시하면 방화벽이 그에 따라 수행
    - 구현 방법에 따라 패킷 필터링(packet filtering) 방식, 프록시(proxy) 방식으로 나뉨
      .패킷 필터링: 방화벽이 네트워크로 들어오거나 나가는 데이터 패킷을 검사하고, 미리 설정된 규칙에 따라 허용 또는 차단하는 방식
      - 주로 IP 주소, 포트 번호, 프로토콜 등의 정보를 기반으로 트래픽을 관리
        .프록시: 클라이언트와 서버 사이에 위치해 중간자 역할을 하는 서버
      - 클라이언트의 요청을 대신 처리하여, 클라이언트가 직접 목적지 서버와 통신하지 않도록 함
      - 클라이언트의 IP를 숨길 수 있고, 캐싱, 트래픽 관리, 콘텐츠 필터링 등을 수행 가능
    - 접근 제어를 수행하는 룰셋 (rule set)
      - 방화벽을 기준으로 보호하려는 네트워크의 외부
      - 내부에 존재하는 시스템의 IP 주소와 포트로 구성
  - 로깅과 감사 추적
    - 방화벽은 룰셋 설정과 변경, 관리자 접근, 네트워크 트래픽의 허용 또는 차단과 관련한 사항을 로그로 남김
    - 사고 발생시 출입자를 확인하여 추적을 하기 위함
  - 인증
    - 방화벽에서는 메세지 인증, 사용자 인증, 클라이언트 인증 방법 사용
    - 메세지 인증
      .VPN과 같은 신뢰할 수 있는 통신선으로 전송되는 메세지의 신뢰성을 보장
    - 사용자 인증
      .패스워드를 이용한 단순한 인증부터 OTP, 토큰 기반 인증 등 높은 수준의 인증 등
    - 클라이언트 인증
      .모바일 사용자처럼 특수한 경우에 접속을 요구하는 호스트 자체가 정당한지 확인하는 방법
  - 데이터 암호화
    - 한 방화벽에서 다른 방화벽으로 데이터를 암호화해서 보내는 것
    - 일반적으로 VPN의 기능을 이용

## 6-5 침입 탐지 시스템

### 침입 탐지 시스템

- 정의

  - 침입 탐지 시스템은 네트워크를 통한 공격을 탐지하기 위한 장비로 내부의 해킹이나 악성 코드 활동 탐지와 같이 방화벽이 하지 못하는 일을 수행
  - 설치 위치와 목적에 따른 구분
    - 호스트 기반 침입 탐지 시스템
      (Host-based Intrusion Detection System, HIDS)
    - 네트워크 기반 침입 탐지 시스템
      (Network-based Intrusion Detection System, NIDS)

- 주요 기능

  - 데이터 수집

    - 호스트 기반의 침입 탐지 시스템(HIDS)
      - 윈도우나 유닉스 등의 운영체제에 부가적으로 설치, 운용되거나 일반 클라이언트에 설치
      - 운영체제에 설정된 사용자 계정에 따라 어떤 사용자가 어떤 접근을 시도하고 어떤 작업을 했는지 기록을 남기고 추적
      - 네트워크 환경과의 연계성이 낮으므로 전체 네트워크에 대한 침입 탐지가 불가능하고 자신이 공격 대상이 될 때만 침입 탐지 가능
      - 운영체제의 취약점이 HIDS를 손상할 수 있으며 다른 침입 탐지 시스템보다 비용이 많이 드는 것이 단점

  - 네트워크 기반의 침입 탐지 시스템(NIDS)

    - 네트워크에서 하나의 독립된 시스템으로 운용
    - 감사와 로깅을 할 때 네트워크 자원이 손실되거나 데이터가 변조되지 않고 HIDS로는 할 수 없는 네트워크 전반에 대한 감시를 할 수 있으며 감시 영역이 상대적으로 큼
    - IP 주소를 소유하지 않아 해커의 직접적인 공격을 거의 완벽하게 방어할 수 있고 존재 사실도 숨길 수 있음
    - 공격에 대한 결과를 알 수 없으며 암호화된 내용을 검사할 수 없음
    - 스위칭 환경에서 NIDS를 설치하려면 다른 부가 장비 필요
    - 10 Gbps 이상의 고속 네트워크에서는 네트워크 카드 등의 하드웨어 적인 한계로 네트워크의 모든 패킷을 검사하기 어렵다는 것이 단점

  - HIDS와 NIDS는 각각 장단점이 있어 상호 보완적으로 사용함

- 데이터 필터링과 축약

  - HIDS와 NIDS로 수집한 침입 관련 데이터를 상호 연관시켜 좀 더 효과적으로 분석하면 공격에 빠르게 대응 가능
  - 보안이 강화된 시스템에 데이터를 보관하면 침입으로 인한 손실을 막을 수 있음
  - 보안 감사에서는 세밀하고 자세한 데이터보다 빠르고 정확하게 파악할 수 있는 데이터가 더 유용하므로 데이터의 효과적인 필터링과 축약이 필수
  - 효과적인 필터링에는 데이터 수집 규칙을 설정하는 작업 필요
  - 클리핑 레벨(clipping level)을 설정

    - 잘못된 패스워드로 일정 횟수 이상 접속하면 로그를 남기도록 하여 조정 가능

  - 침입 탐지

    - 오용 탐지 기법 (Misuse Detection)

      - 이미 발견되고 정립된 공격 패턴을 미리 입력해 두었다가 해당하는 패턴이 탐지되면 알려주는 것
      - 비교적 오탐률이 낮고 효율적이지만, 알려진 공격 외에는 탐지할 수 없고 대량 데이터를 분석하는 데는 부적합
      - 어떤 순서로 공격을 실시했는지에 대한 정보를 얻기 어려움
      - 오용 탐지 기법의 또 다른 형태인 상태 전이(state transition) 방법
        -> 공격 상황에 대한 시나리오를 작성해두고 각각의 상태에 따른 공격을 분석하는 것
        -> 결과가 매우 직관적이지만 세밀한 시나리오를 만들기가 어렵고 추론 엔진이 포함되어 시스템 부하 가능
      - 오탐률이 낮음

      - 지식 기반 침입탐지 (Knowledge-based Detection)
        비정상 행위에 대한 패턴을 입력하여 일치하는 패턴을 탐지
        - 전문가 시스템(Expert System)
        - 상태전이 모델
        - 패턴 매칭(Signature-based Detection)

- 이상 탐지 기법 (Anomaly Detection)

  - 정상적이고 평균적인 상태를 기준으로 급격한 변화를 일으키거나 확률이 낮은 일이 발생하면 알려주는 것
  - 면역 시스템은 새로운 공격을 당하면 스스로 학습하여 다시 그 공격이 발생하면 대응, 재설치를 하면 처음 상태로 되돌아가는 것이 단점
  - 인공지능을 활용하여 침입 탐지 시스템에 활용하는 사례가 급속하게 늘어남
  - 행위 기반 침입탐지 (Behavior Detection)
    정상 행위와 비정상 행위를 프로파일링하여 통계 및 AI를 이용하여 정상/비정상을 구분
    - 통계적 분석
    - 예측 가능한 패턴 생성
    - 신경망 모델
  - 오탐률이 높음

- 오탐과 미탐

  - 오탐 (false positive): 공격이 아닌 것을 공격으로 탐지
  - 미탐 (false negative): 실제 공격을 정상으로 인식하여 탐지하여 못함

- 책임 추적 및 대응

  - 침입 탐지 시스템은 기본적으로 침입을 알려주는 시스템
  - 최근에는 공격을 역추적하여 침입자의 시스템이나 네트워크를 사용하지 못하게 하는 능동적인 기능이 많이 추가됨
    -> 침입 방지 시스템(Intrusion Preventin System, IPS)

- 설치 위치
  1. 패킷이 라우터로 들어오기 전
  - 네트워크에 실행되는 모든 공격 탐지 가능
  - 공격 의도를 가진 패킷을 미리 파악할 수 있지만 공격이 아닌 패킷을 너무 많이 수집하고 내부 네트워크로 침입한 공격과 그렇지 않은 것이 구분되지 않아 효율적인 대응이 어려움
  2. 라우터 뒤
  - 라우터의 패킷 필터링을 거친 패킷 검사
  - 패킷 필터링 과정에서 단순한 공격 패킷이 걸러지므로 더 강력한 의지를 가진 공격자 탐지 가능
  3. 방화벽 뒤
  - 방화벽 뒤에서 탐지되는 공격은 네트워크에 직접 영향을 주므로 공격에 대한 정책과 방화벽 연동성이 가장 중요
  - 내부에서 외부로 향하는 공격도 탐지할 수 있어 내부 공격자도 어느 정도 탐지 가능
  - 침입 탐지 시스템을 한 대만 설치할 수 있다면 이곳에 설치하는 것이 좋음
  4. 내부 네트워크
  - 내부의 클라이언트를 신뢰할 수 없어 내부 네트워크 해킹을 감시하려 할 때 설치
  5. DMZ
  - DMZ에 침입 탐지 시스템을 설치하는 이유
    -> 능력이 매우 뛰어난 외부 및 내부 공격자에 의한 중요 데이터의 손실이나 서비스 중단을 막기 위함
  - 중요 데이터와 자원을 보호하기 위해 침입 탐지 시스템을 별도로 운영하기도 함

-> 침입 탐지 시스템의 설치 우선순위는 3 -> 5 -> 4 -> 2 -> 1
-> 네트워크의 목적에 따라 중간에 NIDS를 선택적으로 설치 가능
-> HIDS는 유지, 관리 비용이 너무 많이 들어서 웹 서버와 같이 사업을 유지하는 매우 중요한 시스템에만 설치

## 6-6 침입 방지 시스템

### 침입 방지 시스템

- 개발 이유

  - 방화벽이 공격을 차단하는 비율은 30%
  - 공격에 대한 능동적인 분석과 차단을 수행하기 위해 침입 방지 시스템 (Intrusion Prevention System, IPS) 개발

- 필요성

  - 방화벽은 IP 주소나 포트에 의한 네트워크 공격을 차단할 수 있지만
  - 응용 프로그램 수준의 공격과 새로운 패턴의 공격에 대한 적응력이 낮고 실시간 대응이 어려움
  - 침입 탐지 시스템은 실시간 탐지는 가능하지만 대응책을 제시하지 못하기 때문에 대안 필요
  - 취약점 발표 후 실제 공격까지 하루가 채 걸리지 않는 제로데이 공격(zero day attack)이 많음
  - 방화벽과 침입탐지 시스템의 단점을 보완할 시스템이 필요

- 동작 원리

  - 침입 방지 시스템은 침입 탐지 시스템과 방화벽의 조합
  - 침입 탐지 기능을 수행하는 모듈이 패킷 하나하나를 검사, 분석하여 정상적이지 않으면 방화벽 기능의 모듈로 패킷 차단
  - 공격의 종류와 기술이 다양해지면서 모든 유형의 패턴을 등록하여 차단할 수는 없음
  - 침입 방지 시스템에 가상 머신 (virtual machine)을 이용한 악성 코드 탐지 개념 도입
  - 가상 머신을 이용한 탐지
    - 네트워크에서 확인되는 실행 파일, 악성 코드와 같은 형태, 공격으로 보이는 패킷 등을 분석하지 않고 침입 방지 시스템에 내장된 가상 머신에 보내 그대로 실행시키는 것
    - 가상 머신에서 실행된 코드나 패킷이 키보드 해킹이나 무차별 네트워크 트래픽 생성 등 코드와 유사한 동작을 보이면 해당 패킷을 차단

- 설치
  - 침입 방지 시스템은 일반적으로 방화벽 다음에 설치
  - 방화벽이 네트워크 앞부분에서 불필요한 외부 패킷을 한 번 걸러주어 더 효율적으로 패킷 검사 가능
  - 방화벽 없이 침입 방지 시스템만 설치하기도 함
  - 하드웨어 칩으로 만든 ASIC(Application Specific Integrated Circuit)를 소프트웨어로 많이 이용

### FW, IDS, IPS 비교

| 구분 | 방화벽 (Firewall) | 침입탐지 시스템 (IDS) | 침입방지 시스템(IPS) |
| 역할 | 네트워크 트래픽을 필터링하고 차단 또는 허용 | 네트워크 또는 시스템에서 의심스러운 활동 탐지 | 의심스러운 활동을 탐지하고, 이를 차단 또는 대응 |
| 작동 방식 | 사전 정의된 규칙에 따라 트래픽 제어 | 트래픽 또는 시스템 로그 분석을 통해 감지 | 탐지 후 자동으로 공격을 차단하거나 조치를 취함 |
| 위치 | 네트워크 경계에 배치 | 네트워크 내부에 배치, 트래픽을 모니터링 | 네트워크 경계 또는 내부에 배치, 트래픽을 제어 |
| 대응 방식 | 트래픽 허용 또는 차단 | 공격이 감지되면 관리자에게 알림 | 공격 감지 시 실시간으로 차단 |
| 주요 기능 | 포트, IP, 프로토콜 기반 필터링 | 패턴 기반, 이상 행위 탐지 | 패턴 기반 탐지 + 실시간 대응 |
| 보안 수준 | 기본적인 접근 제어 제공 | 탐지만 하고, 차단 기능은 없음 | 탐지와 차단 모두 가능, 더 높은 보안 제공 |
| 특징 | 외부 공격으로부터 네트워크 보호 | 공격을 감지하지만, 자동으로 차단하지 않음 | 공격을 차단하며, 네트워크 성능에 영향을 줄 수 있음 |
| 적용 예시 | 허용되지 않은 IP에서의 접근 차단 | 비정상적인 트래픽이 발생하면 경고 | DDoS 공격이나 악성 코드 감염시 실시간 차단 |
